var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var r,i,n,s,a,o,h,u,l,c,d,p,f,g,m,v=!1;function y(){if(!v){v=!0;var t=navigator.userAgent,e=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(t),y=/(Mac OS X)|(Windows)|(Linux)/.exec(t);if(p=/\b(iPhone|iP[ao]d)/.exec(t),f=/\b(iP[ao]d)/.exec(t),c=/Android/i.exec(t),g=/FBAN\/\w+;/i.exec(t),m=/Mobile/i.exec(t),d=!!/Win64/.exec(t),e){(r=e[1]?parseFloat(e[1]):e[5]?parseFloat(e[5]):NaN)&&document&&document.documentMode&&(r=document.documentMode);var w=/(?:Trident\/(\d+.\d+))/.exec(t);o=w?parseFloat(w[1])+4:r,i=e[2]?parseFloat(e[2]):NaN,n=e[3]?parseFloat(e[3]):NaN,(s=e[4]?parseFloat(e[4]):NaN)?(e=/(?:Chrome\/(\d+\.\d+))/.exec(t),a=e&&e[1]?parseFloat(e[1]):NaN):a=NaN}else r=i=n=a=s=NaN;if(y){if(y[1]){var b=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(t);h=!b||parseFloat(b[1].replace("_","."))}else h=!1;u=!!y[2],l=!!y[3]}else h=u=l=!1}}var w,b={ie:function(){return y()||r},ieCompatibilityMode:function(){return y()||o>r},ie64:function(){return b.ie()&&d},firefox:function(){return y()||i},opera:function(){return y()||n},webkit:function(){return y()||s},safari:function(){return b.webkit()},chrome:function(){return y()||a},windows:function(){return y()||u},osx:function(){return y()||h},linux:function(){return y()||l},iphone:function(){return y()||p},mobile:function(){return y()||p||f||c||m},nativeApp:function(){return y()||g},android:function(){return y()||c},ipad:function(){return y()||f}},x=b,E=!("undefined"==typeof window||!window.document||!window.document.createElement),_={canUseDOM:E,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:E&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:E&&!!window.screen,isInWorker:!E};_.canUseDOM&&(w=document.implementation&&document.implementation.hasFeature&&!0!==document.implementation.hasFeature("",""))
/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */;var M=x,A=function(t,e){if(!_.canUseDOM||e&&!("addEventListener"in document))return!1;var r="on"+t,i=r in document;if(!i){var n=document.createElement("div");n.setAttribute(r,"return;"),i="function"==typeof n[r]}return!i&&w&&"wheel"===t&&(i=document.implementation.hasFeature("Events.wheel","3.0")),i};function T(t){var e=0,r=0,i=0,n=0;return"detail"in t&&(r=t.detail),"wheelDelta"in t&&(r=-t.wheelDelta/120),"wheelDeltaY"in t&&(r=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=r,r=0),i=10*e,n=10*r,"deltaY"in t&&(n=t.deltaY),"deltaX"in t&&(i=t.deltaX),(i||n)&&t.deltaMode&&(1==t.deltaMode?(i*=40,n*=40):(i*=800,n*=800)),i&&!e&&(e=i<1?-1:1),n&&!r&&(r=n<1?-1:1),{spinX:e,spinY:r,pixelX:i,pixelY:n}}T.getEventType=function(){return M.firefox()?"DOMMouseScroll":A("wheel")?"wheel":"mousewheel"};var S=e(T);var F=function(t,e){for(var r=-1,i=null==t?0:t.length;++r<i&&!1!==e(t[r],r,t););return t};var O=function(t){return function(e,r,i){for(var n=-1,s=Object(e),a=i(e),o=a.length;o--;){var h=a[t?o:++n];if(!1===r(s[h],h,s))break}return e}},R=O();var C=function(t,e){for(var r=-1,i=Array(t);++r<t;)i[r]=e(r);return i},L="object"==typeof t&&t&&t.Object===Object&&t,P=L,D="object"==typeof self&&self&&self.Object===Object&&self,N=P||D||Function("return this")(),B=N.Symbol,z=B,U=Object.prototype,I=U.hasOwnProperty,j=U.toString,k=z?z.toStringTag:void 0;var Y=function(t){var e=I.call(t,k),r=t[k];try{t[k]=void 0;var i=!0}catch(t){}var n=j.call(t);return i&&(e?t[k]=r:delete t[k]),n},q=Object.prototype.toString;var X=Y,W=function(t){return q.call(t)},G=B?B.toStringTag:void 0;var H=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":G&&G in Object(t)?X(t):W(t)};var V=function(t){return null!=t&&"object"==typeof t},$=H,Q=V;var Z=function(t){return Q(t)&&"[object Arguments]"==$(t)},K=V,J=Object.prototype,tt=J.hasOwnProperty,et=J.propertyIsEnumerable,rt=Z(function(){return arguments}())?Z:function(t){return K(t)&&tt.call(t,"callee")&&!et.call(t,"callee")},it=Array.isArray,nt={exports:{}};var st=function(){return!1};!function(t,e){var r=N,i=st,n=e&&!e.nodeType&&e,s=n&&t&&!t.nodeType&&t,a=s&&s.exports===n?r.Buffer:void 0,o=(a?a.isBuffer:void 0)||i;t.exports=o}(nt,nt.exports);var at=nt.exports,ot=/^(?:0|[1-9]\d*)$/;var ht=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&ot.test(t))&&t>-1&&t%1==0&&t<e};var ut=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},lt=H,ct=ut,dt=V,pt={};pt["[object Float32Array]"]=pt["[object Float64Array]"]=pt["[object Int8Array]"]=pt["[object Int16Array]"]=pt["[object Int32Array]"]=pt["[object Uint8Array]"]=pt["[object Uint8ClampedArray]"]=pt["[object Uint16Array]"]=pt["[object Uint32Array]"]=!0,pt["[object Arguments]"]=pt["[object Array]"]=pt["[object ArrayBuffer]"]=pt["[object Boolean]"]=pt["[object DataView]"]=pt["[object Date]"]=pt["[object Error]"]=pt["[object Function]"]=pt["[object Map]"]=pt["[object Number]"]=pt["[object Object]"]=pt["[object RegExp]"]=pt["[object Set]"]=pt["[object String]"]=pt["[object WeakMap]"]=!1;var ft=function(t){return dt(t)&&ct(t.length)&&!!pt[lt(t)]};var gt=function(t){return function(e){return t(e)}},mt={exports:{}};!function(t,e){var r=L,i=e&&!e.nodeType&&e,n=i&&t&&!t.nodeType&&t,s=n&&n.exports===i&&r.process,a=function(){try{var t=n&&n.require&&n.require("util").types;return t||s&&s.binding&&s.binding("util")}catch(t){}}();t.exports=a}(mt,mt.exports);var vt=mt.exports,yt=ft,wt=gt,bt=vt&&vt.isTypedArray,xt=bt?wt(bt):yt,Et=C,_t=rt,Mt=it,At=at,Tt=ht,St=xt,Ft=Object.prototype.hasOwnProperty;var Ot=function(t,e){var r=Mt(t),i=!r&&_t(t),n=!r&&!i&&At(t),s=!r&&!i&&!n&&St(t),a=r||i||n||s,o=a?Et(t.length,String):[],h=o.length;for(var u in t)!e&&!Ft.call(t,u)||a&&("length"==u||n&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Tt(u,h))||o.push(u);return o},Rt=Object.prototype;var Ct=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Rt)};var Lt=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),Pt=Ct,Dt=Lt,Nt=Object.prototype.hasOwnProperty;var Bt=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},zt=H,Ut=Bt;var It=function(t){if(!Ut(t))return!1;var e=zt(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},jt=It,kt=ut;var Yt=function(t){return null!=t&&kt(t.length)&&!jt(t)},qt=Ot,Xt=function(t){if(!Pt(t))return Dt(t);var e=[];for(var r in Object(t))Nt.call(t,r)&&"constructor"!=r&&e.push(r);return e},Wt=Yt;var Gt=function(t){return Wt(t)?qt(t):Xt(t)},Ht=R,Vt=Gt;var $t=Yt;var Qt=function(t,e){return function(r,i){if(null==r)return r;if(!$t(r))return t(r,i);for(var n=r.length,s=e?n:-1,a=Object(r);(e?s--:++s<n)&&!1!==i(a[s],s,a););return r}},Zt=Qt((function(t,e){return t&&Ht(t,e,Vt)}));var Kt=function(t){return t},Jt=Kt;var te=F,ee=Zt,re=function(t){return"function"==typeof t?t:Jt},ie=it;var ne=e((function(t,e){return(ie(t)?te:ee)(t,re(e))}));const se=new class{isMobile(){return/Mobi|Andrdoid|Tablet|iPad|iPhone/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1}};function ae(t){let e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function oe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function he(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function ue(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function le(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function ce(t){let e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function de(t,e){let r=e[0],i=e[1],n=e[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function pe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function fe(t,e,r){let i=e[0],n=e[1],s=e[2],a=r[0],o=r[1],h=r[2];return t[0]=n*h-s*o,t[1]=s*a-i*h,t[2]=i*o-n*a,t}const ge=function(){const t=[0,0,0],e=[0,0,0];return function(r,i){oe(t,r),oe(e,i),de(t,t),de(e,e);let n=pe(t,e);return n>1?0:n<-1?Math.PI:Math.acos(n)}}();class me extends Array{constructor(t=0,e=t,r=t){return super(t,e,r),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set(t,e=t,r=t){return t.length?this.copy(t):(function(t,e,r,i){t[0]=e,t[1]=r,t[2]=i}(this,t,e,r),this)}copy(t){return oe(this,t),this}add(t,e){return e?he(this,t,e):he(this,this,t),this}sub(t,e){return e?ue(this,t,e):ue(this,this,t),this}multiply(t){var e,r,i;return t.length?(r=this,i=t,(e=this)[0]=r[0]*i[0],e[1]=r[1]*i[1],e[2]=r[2]*i[2]):le(this,this,t),this}divide(t){var e,r,i;return t.length?(r=this,i=t,(e=this)[0]=r[0]/i[0],e[1]=r[1]/i[1],e[2]=r[2]/i[2]):le(this,this,1/t),this}inverse(t=this){var e,r;return r=t,(e=this)[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],this}len(){return ae(this)}distance(t){return t?function(t,e){let r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}(this,t):ae(this)}squaredLen(){return ce(this)}squaredDistance(t){return t?function(t,e){let r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}(this,t):ce(this)}negate(t=this){var e,r;return r=t,(e=this)[0]=-r[0],e[1]=-r[1],e[2]=-r[2],this}cross(t,e){return e?fe(this,t,e):fe(this,this,t),this}scale(t){return le(this,this,t),this}normalize(){return de(this,this),this}dot(t){return pe(this,t)}equals(t){return r=t,(e=this)[0]===r[0]&&e[1]===r[1]&&e[2]===r[2];var e,r}applyMatrix3(t){return function(t,e,r){let i=e[0],n=e[1],s=e[2];t[0]=i*r[0]+n*r[3]+s*r[6],t[1]=i*r[1]+n*r[4]+s*r[7],t[2]=i*r[2]+n*r[5]+s*r[8]}(this,this,t),this}applyMatrix4(t){return function(t,e,r){let i=e[0],n=e[1],s=e[2],a=r[3]*i+r[7]*n+r[11]*s+r[15];a=a||1,t[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/a,t[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/a,t[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/a}(this,this,t),this}scaleRotateMatrix4(t){return function(t,e,r){let i=e[0],n=e[1],s=e[2],a=r[3]*i+r[7]*n+r[11]*s+r[15];a=a||1,t[0]=(r[0]*i+r[4]*n+r[8]*s)/a,t[1]=(r[1]*i+r[5]*n+r[9]*s)/a,t[2]=(r[2]*i+r[6]*n+r[10]*s)/a}(this,this,t),this}applyQuaternion(t){return function(t,e,r){let i=e[0],n=e[1],s=e[2],a=r[0],o=r[1],h=r[2],u=o*s-h*n,l=h*i-a*s,c=a*n-o*i,d=o*c-h*l,p=h*u-a*c,f=a*l-o*u,g=2*r[3];u*=g,l*=g,c*=g,d*=2,p*=2,f*=2,t[0]=i+u+d,t[1]=n+l+p,t[2]=s+c+f}(this,this,t),this}angle(t){return ge(this,t)}lerp(t,e){return function(t,e,r,i){let n=e[0],s=e[1],a=e[2];t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=a+i*(r[2]-a)}(this,this,t,e),this}clone(){return new me(this[0],this[1],this[2])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}transformDirection(t){const e=this[0],r=this[1],i=this[2];return this[0]=t[0]*e+t[4]*r+t[8]*i,this[1]=t[1]*e+t[5]*r+t[9]*i,this[2]=t[2]*e+t[6]*r+t[10]*i,this.normalize()}}const ve=new me;let ye=1,we=1,be=!1;class xe{constructor(t,e={}){t.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=t,this.attributes=e,this.id=ye++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let t in e)this.addAttribute(t,e[t])}addAttribute(t,e){if(this.attributes[t]=e,e.id=we++,e.size=e.size||1,e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.normalized=e.normalized||!1,e.stride=e.stride||0,e.offset=e.offset||0,e.count=e.count||(e.stride?e.data.byteLength/e.stride:e.data.length/e.size),e.divisor=e.instanced||0,e.needsUpdate=!1,e.usage=e.usage||this.gl.STATIC_DRAW,e.buffer||this.updateAttribute(e),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}updateAttribute(t){const e=!t.buffer;e&&(t.buffer=this.gl.createBuffer()),this.glState.boundBuffer!==t.buffer&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.buffer),e?this.gl.bufferData(t.target,t.data,t.usage):this.gl.bufferSubData(t.target,0,t.data),t.needsUpdate=!1}setIndex(t){this.addAttribute("index",t)}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach(((t,{name:e,type:r})=>{if(!this.attributes[e])return void console.warn(`active attribute ${e} not being supplied`);const i=this.attributes[e];this.gl.bindBuffer(i.target,i.buffer),this.glState.boundBuffer=i.buffer;let n=1;35674===r&&(n=2),35675===r&&(n=3),35676===r&&(n=4);const s=i.size/n,a=1===n?0:n*n*n,o=1===n?0:n*n;for(let e=0;e<n;e++)this.gl.vertexAttribPointer(t+e,s,i.type,i.normalized,i.stride+a,i.offset+e*o),this.gl.enableVertexAttribArray(t+e),this.gl.renderer.vertexAttribDivisor(t+e,i.divisor)})),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:t,mode:e=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${t.attributeOrder}`&&(this.VAOs[t.attributeOrder]||this.createVAO(t),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${t.attributeOrder}`),t.attributeLocations.forEach(((t,{name:e})=>{const r=this.attributes[e];r.needsUpdate&&this.updateAttribute(r)})),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(e,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start):this.gl.drawArrays(e,this.drawRange.start,this.drawRange.count)}getPosition(){const t=this.attributes.position;return t.data?t:be?void 0:(console.warn("No position buffer data found to compute bounds"),be=!0)}computeBoundingBox(t){t||(t=this.getPosition());const e=t.data,r=t.stride?t.stride/e.BYTES_PER_ELEMENT:t.size;this.bounds||(this.bounds={min:new me,max:new me,center:new me,scale:new me,radius:1/0});const i=this.bounds.min,n=this.bounds.max,s=this.bounds.center,a=this.bounds.scale;i.set(1/0),n.set(-1/0);for(let t=0,s=e.length;t<s;t+=r){const r=e[t],s=e[t+1],a=e[t+2];i.x=Math.min(r,i.x),i.y=Math.min(s,i.y),i.z=Math.min(a,i.z),n.x=Math.max(r,n.x),n.y=Math.max(s,n.y),n.z=Math.max(a,n.z)}a.sub(n,i),s.add(i,n).divide(2)}computeBoundingSphere(t){t||(t=this.getPosition());const e=t.data,r=t.stride?t.stride/e.BYTES_PER_ELEMENT:t.size;this.bounds||this.computeBoundingBox(t);let i=0;for(let t=0,n=e.length;t<n;t+=r)ve.fromArray(e,t),i=Math.max(i,this.bounds.center.squaredDistance(ve));this.bounds.radius=Math.sqrt(i)}remove(){for(let t in this.VAOs)this.gl.renderer.deleteVertexArray(this.VAOs[t]),delete this.VAOs[t];for(let t in this.attributes)this.gl.deleteBuffer(this.attributes[t].buffer),delete this.attributes[t]}}let Ee=1;const _e={};class Me{constructor(t,{vertex:e,fragment:r,uniforms:i={},transparent:n=!1,cullFace:s=t.BACK,frontFace:a=t.CCW,depthTest:o=!0,depthWrite:h=!0,depthFunc:u=t.LESS}={}){t.canvas||console.error("gl not passed as first argument to Program"),this.gl=t,this.uniforms=i,this.id=Ee++,e||console.warn("vertex shader not supplied"),r||console.warn("fragment shader not supplied"),this.transparent=n,this.cullFace=s,this.frontFace=a,this.depthTest=o,this.depthWrite=h,this.depthFunc=u,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));const l=t.createShader(t.VERTEX_SHADER);t.shaderSource(l,e),t.compileShader(l),""!==t.getShaderInfoLog(l)&&console.warn(`${t.getShaderInfoLog(l)}\nVertex Shader\n${Te(e)}`);const c=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(c,r),t.compileShader(c),""!==t.getShaderInfoLog(c)&&console.warn(`${t.getShaderInfoLog(c)}\nFragment Shader\n${Te(r)}`),this.program=t.createProgram(),t.attachShader(this.program,l),t.attachShader(this.program,c),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))return console.warn(t.getProgramInfoLog(this.program));t.deleteShader(l),t.deleteShader(c),this.uniformLocations=new Map;let d=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);for(let e=0;e<d;e++){let r=t.getActiveUniform(this.program,e);this.uniformLocations.set(r,t.getUniformLocation(this.program,r.name));const i=r.name.match(/(\w+)/g);r.uniformName=i[0],3===i.length?(r.isStructArray=!0,r.structIndex=Number(i[1]),r.structProperty=i[2]):2===i.length&&isNaN(Number(i[1]))&&(r.isStruct=!0,r.structProperty=i[1])}this.attributeLocations=new Map;const p=[],f=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);for(let e=0;e<f;e++){const r=t.getActiveAttrib(this.program,e),i=t.getAttribLocation(this.program,r.name);-1!==i&&(p[i]=r.name,this.attributeLocations.set(r,i))}this.attributeOrder=p.join("")}setBlendFunc(t,e,r,i){this.blendFunc.src=t,this.blendFunc.dst=e,this.blendFunc.srcAlpha=r,this.blendFunc.dstAlpha=i,t&&(this.transparent=!0)}setBlendEquation(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:t=!1}={}){let e=-1;this.gl.renderer.state.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.state.currentProgram=this.id),this.uniformLocations.forEach(((t,r)=>{let i=r.uniformName,n=this.uniforms[i];if(r.isStruct&&(n=n[r.structProperty],i+=`.${r.structProperty}`),r.isStructArray&&(n=n[r.structIndex][r.structProperty],i+=`[${r.structIndex}].${r.structProperty}`),!n)return Fe(`Active uniform ${i} has not been supplied`);if(n&&void 0===n.value)return Fe(`${i} uniform is missing a value parameter`);if(n.value.texture)return e+=1,n.value.update(e),Ae(this.gl,r.type,t,e);if(n.value.length&&n.value[0].texture){const i=[];return n.value.forEach((t=>{e+=1,t.update(e),i.push(e)})),Ae(this.gl,r.type,t,i)}Ae(this.gl,r.type,t,n.value)})),this.applyState(),t&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function Ae(t,e,r,i){i=i.length?function(t){const e=t.length,r=t[0].length;if(void 0===r)return t;const i=e*r;let n=_e[i];n||(_e[i]=n=new Float32Array(i));for(let i=0;i<e;i++)n.set(t[i],i*r);return n}(i):i;const n=t.renderer.state.uniformLocations.get(r);if(i.length)if(void 0===n||n.length!==i.length)t.renderer.state.uniformLocations.set(r,i.slice(0));else{if(function(t,e){if(t.length!==e.length)return!1;for(let r=0,i=t.length;r<i;r++)if(t[r]!==e[r])return!1;return!0}(n,i))return;n.set?n.set(i):function(t,e){for(let r=0,i=t.length;r<i;r++)t[r]=e[r]}(n,i),t.renderer.state.uniformLocations.set(r,n)}else{if(n===i)return;t.renderer.state.uniformLocations.set(r,i)}switch(e){case 5126:return i.length?t.uniform1fv(r,i):t.uniform1f(r,i);case 35664:return t.uniform2fv(r,i);case 35665:return t.uniform3fv(r,i);case 35666:return t.uniform4fv(r,i);case 35670:case 5124:case 35678:case 35680:return i.length?t.uniform1iv(r,i):t.uniform1i(r,i);case 35671:case 35667:return t.uniform2iv(r,i);case 35672:case 35668:return t.uniform3iv(r,i);case 35673:case 35669:return t.uniform4iv(r,i);case 35674:return t.uniformMatrix2fv(r,!1,i);case 35675:return t.uniformMatrix3fv(r,!1,i);case 35676:return t.uniformMatrix4fv(r,!1,i)}}function Te(t){let e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}let Se=0;function Fe(t){Se>100||(console.warn(t),Se++,Se>100&&console.warn("More than 100 program warnings - stopping logs."))}const Oe=new me;let Re=1;class Ce{constructor({canvas:t=document.createElement("canvas"),width:e=300,height:r=150,dpr:i=1,alpha:n=!1,depth:s=!0,stencil:a=!1,antialias:o=!1,premultipliedAlpha:h=!1,preserveDrawingBuffer:u=!1,powerPreference:l="default",autoClear:c=!0,webgl:d=2}={}){const p={alpha:n,depth:s,stencil:a,antialias:o,premultipliedAlpha:h,preserveDrawingBuffer:u,powerPreference:l};this.dpr=i,this.alpha=n,this.color=!0,this.depth=s,this.stencil=a,this.premultipliedAlpha=h,this.autoClear=c,this.id=Re++,2===d&&(this.gl=t.getContext("webgl2",p)),this.isWebgl2=!!this.gl,this.gl||(this.gl=t.getContext("webgl",p)),this.gl||console.error("unable to create webgl context"),this.gl.renderer=this,this.setSize(e,r),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={x:0,y:0,width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.state.currentProgram=null,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.getExtension("WEBGL_compressed_texture_astc"),this.getExtension("EXT_texture_compression_bptc"),this.getExtension("WEBGL_compressed_texture_s3tc"),this.getExtension("WEBGL_compressed_texture_etc1"),this.getExtension("WEBGL_compressed_texture_pvrtc"),this.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*this.dpr,this.gl.canvas.height=e*this.dpr,Object.assign(this.gl.canvas.style,{width:t+"px",height:e+"px"})}setViewport(t,e,r=0,i=0){this.state.viewport.width===t&&this.state.viewport.height===e||(this.state.viewport.width=t,this.state.viewport.height=e,this.state.viewport.x=r,this.state.viewport.y=i,this.gl.viewport(r,i,t,e))}setScissor(t,e,r=0,i=0){this.gl.scissor(r,i,t,e)}enable(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)}disable(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)}setBlendFunc(t,e,r,i){this.state.blendFunc.src===t&&this.state.blendFunc.dst===e&&this.state.blendFunc.srcAlpha===r&&this.state.blendFunc.dstAlpha===i||(this.state.blendFunc.src=t,this.state.blendFunc.dst=e,this.state.blendFunc.srcAlpha=r,this.state.blendFunc.dstAlpha=i,void 0!==r?this.gl.blendFuncSeparate(t,e,r,i):this.gl.blendFunc(t,e))}setBlendEquation(t,e){t=t||this.gl.FUNC_ADD,this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===e||(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,void 0!==e?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}setCullFace(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}setFrontFace(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}setDepthMask(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}setDepthFunc(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}activeTexture(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}bindFramebuffer({target:t=this.gl.FRAMEBUFFER,buffer:e=null}={}){this.state.framebuffer!==e&&(this.state.framebuffer=e,this.gl.bindFramebuffer(t,e))}getExtension(t,e,r){return e&&this.gl[e]?this.gl[e].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),e?this.extensions[t]?this.extensions[t][r].bind(this.extensions[t]):null:this.extensions[t])}sortOpaque(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}sortTransparent(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}sortUI(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}getRenderList({scene:t,camera:e,frustumCull:r,sort:i}){let n=[];if(e&&r&&e.updateFrustum(),t.traverse((t=>{if(!t.visible)return!0;t.draw&&(r&&t.frustumCulled&&e&&!e.frustumIntersectsMesh(t)||n.push(t))})),i){const t=[],r=[],i=[];n.forEach((n=>{n.program.transparent?n.program.depthTest?r.push(n):i.push(n):t.push(n),n.zDepth=0,0===n.renderOrder&&n.program.depthTest&&e&&(n.worldMatrix.getTranslation(Oe),Oe.applyMatrix4(e.projectionViewMatrix),n.zDepth=Oe.z)})),t.sort(this.sortOpaque),r.sort(this.sortTransparent),i.sort(this.sortUI),n=t.concat(r,i)}return n}render({scene:t,camera:e,target:r=null,update:i=!0,sort:n=!0,frustumCull:s=!0,clear:a}){null===r?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(r),this.setViewport(r.width,r.height)),(a||this.autoClear&&!1!==a)&&(!this.depth||r&&!r.depth||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),i&&t.updateMatrixWorld(),e&&e.updateMatrixWorld();this.getRenderList({scene:t,camera:e,frustumCull:s,sort:n}).forEach((t=>{t.draw({camera:e})}))}}function Le(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3],o=r[0],h=r[1],u=r[2],l=r[3];return t[0]=i*l+a*o+n*u-s*h,t[1]=n*l+a*h+s*o-i*u,t[2]=s*l+a*u+i*h-n*o,t[3]=a*l-i*o-n*h-s*u,t}const Pe=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},De=function(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t},Ne=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Be=function(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=r*r+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=i*a,t[2]=n*a,t[3]=s*a,t};class ze extends Array{constructor(t=0,e=0,r=0,i=1){return super(t,e,r,i),this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this[0]=t,this.onChange()}set y(t){this[1]=t,this.onChange()}set z(t){this[2]=t,this.onChange()}set w(t){this[3]=t,this.onChange()}identity(){var t;return(t=this)[0]=0,t[1]=0,t[2]=0,t[3]=1,this.onChange(),this}set(t,e,r,i){return t.length?this.copy(t):(De(this,t,e,r,i),this.onChange(),this)}rotateX(t){return function(t,e,r){r*=.5;let i=e[0],n=e[1],s=e[2],a=e[3],o=Math.sin(r),h=Math.cos(r);t[0]=i*h+a*o,t[1]=n*h+s*o,t[2]=s*h-n*o,t[3]=a*h-i*o}(this,this,t),this.onChange(),this}rotateY(t){return function(t,e,r){r*=.5;let i=e[0],n=e[1],s=e[2],a=e[3],o=Math.sin(r),h=Math.cos(r);t[0]=i*h-s*o,t[1]=n*h+a*o,t[2]=s*h+i*o,t[3]=a*h-n*o}(this,this,t),this.onChange(),this}rotateZ(t){return function(t,e,r){r*=.5;let i=e[0],n=e[1],s=e[2],a=e[3],o=Math.sin(r),h=Math.cos(r);t[0]=i*h+n*o,t[1]=n*h-i*o,t[2]=s*h+a*o,t[3]=a*h-s*o}(this,this,t),this.onChange(),this}inverse(t=this){return function(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=r*r+i*i+n*n+s*s,o=a?1/a:0;t[0]=-r*o,t[1]=-i*o,t[2]=-n*o,t[3]=s*o}(this,t),this.onChange(),this}conjugate(t=this){var e,r;return r=t,(e=this)[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e[3]=r[3],this.onChange(),this}copy(t){return Pe(this,t),this.onChange(),this}normalize(t=this){return Be(this,t),this.onChange(),this}multiply(t,e){return e?Le(this,t,e):Le(this,this,t),this.onChange(),this}dot(t){return Ne(this,t)}fromMatrix3(t){return function(t,e){let r,i=e[0]+e[4]+e[8];if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);let n=(i+1)%3,s=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*n+n]-e[3*s+s]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*n+s]-e[3*s+n])*r,t[n]=(e[3*n+i]+e[3*i+n])*r,t[s]=(e[3*s+i]+e[3*i+s])*r}}(this,t),this.onChange(),this}fromEuler(t){return function(t,e,r="YXZ"){let i=Math.sin(.5*e[0]),n=Math.cos(.5*e[0]),s=Math.sin(.5*e[1]),a=Math.cos(.5*e[1]),o=Math.sin(.5*e[2]),h=Math.cos(.5*e[2]);"XYZ"===r?(t[0]=i*a*h+n*s*o,t[1]=n*s*h-i*a*o,t[2]=n*a*o+i*s*h,t[3]=n*a*h-i*s*o):"YXZ"===r?(t[0]=i*a*h+n*s*o,t[1]=n*s*h-i*a*o,t[2]=n*a*o-i*s*h,t[3]=n*a*h+i*s*o):"ZXY"===r?(t[0]=i*a*h-n*s*o,t[1]=n*s*h+i*a*o,t[2]=n*a*o+i*s*h,t[3]=n*a*h-i*s*o):"ZYX"===r?(t[0]=i*a*h-n*s*o,t[1]=n*s*h+i*a*o,t[2]=n*a*o-i*s*h,t[3]=n*a*h+i*s*o):"YZX"===r?(t[0]=i*a*h+n*s*o,t[1]=n*s*h+i*a*o,t[2]=n*a*o-i*s*h,t[3]=n*a*h-i*s*o):"XZY"===r&&(t[0]=i*a*h-n*s*o,t[1]=n*s*h-i*a*o,t[2]=n*a*o+i*s*h,t[3]=n*a*h+i*s*o)}(this,t,t.order),this}fromAxisAngle(t,e){return function(t,e,r){r*=.5;let i=Math.sin(r);t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r)}(this,t,e),this.onChange(),this}slerp(t,e){return function(t,e,r,i){let n,s,a,o,h,u=e[0],l=e[1],c=e[2],d=e[3],p=r[0],f=r[1],g=r[2],m=r[3];s=u*p+l*f+c*g+d*m,s<0&&(s=-s,p=-p,f=-f,g=-g,m=-m),1-s>1e-6?(n=Math.acos(s),a=Math.sin(n),o=Math.sin((1-i)*n)/a,h=Math.sin(i*n)/a):(o=1-i,h=i),t[0]=o*u+h*p,t[1]=o*l+h*f,t[2]=o*c+h*g,t[3]=o*d+h*m}(this,this,t,e),this.onChange(),this}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this.onChange(),this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}}function Ue(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=e[9],p=e[10],f=e[11],g=e[12],m=e[13],v=e[14],y=e[15],w=r[0],b=r[1],x=r[2],E=r[3];return t[0]=w*i+b*o+x*c+E*g,t[1]=w*n+b*h+x*d+E*m,t[2]=w*s+b*u+x*p+E*v,t[3]=w*a+b*l+x*f+E*y,w=r[4],b=r[5],x=r[6],E=r[7],t[4]=w*i+b*o+x*c+E*g,t[5]=w*n+b*h+x*d+E*m,t[6]=w*s+b*u+x*p+E*v,t[7]=w*a+b*l+x*f+E*y,w=r[8],b=r[9],x=r[10],E=r[11],t[8]=w*i+b*o+x*c+E*g,t[9]=w*n+b*h+x*d+E*m,t[10]=w*s+b*u+x*p+E*v,t[11]=w*a+b*l+x*f+E*y,w=r[12],b=r[13],x=r[14],E=r[15],t[12]=w*i+b*o+x*c+E*g,t[13]=w*n+b*h+x*d+E*m,t[14]=w*s+b*u+x*p+E*v,t[15]=w*a+b*l+x*f+E*y,t}function Ie(t,e){let r=e[0],i=e[1],n=e[2],s=e[4],a=e[5],o=e[6],h=e[8],u=e[9],l=e[10];return t[0]=Math.hypot(r,i,n),t[1]=Math.hypot(s,a,o),t[2]=Math.hypot(h,u,l),t}const je=function(){const t=[0,0,0];return function(e,r){let i=t;Ie(i,r);let n=1/i[0],s=1/i[1],a=1/i[2],o=r[0]*n,h=r[1]*s,u=r[2]*a,l=r[4]*n,c=r[5]*s,d=r[6]*a,p=r[8]*n,f=r[9]*s,g=r[10]*a,m=o+c+g,v=0;return m>0?(v=2*Math.sqrt(m+1),e[3]=.25*v,e[0]=(d-f)/v,e[1]=(p-u)/v,e[2]=(h-l)/v):o>c&&o>g?(v=2*Math.sqrt(1+o-c-g),e[3]=(d-f)/v,e[0]=.25*v,e[1]=(h+l)/v,e[2]=(p+u)/v):c>g?(v=2*Math.sqrt(1+c-o-g),e[3]=(p-u)/v,e[0]=(h+l)/v,e[1]=.25*v,e[2]=(d+f)/v):(v=2*Math.sqrt(1+g-o-c),e[3]=(h-l)/v,e[0]=(p+u)/v,e[1]=(d+f)/v,e[2]=.25*v),e}}();class ke extends Array{constructor(t=1,e=0,r=0,i=0,n=0,s=1,a=0,o=0,h=0,u=0,l=1,c=0,d=0,p=0,f=0,g=1){return super(t,e,r,i,n,s,a,o,h,u,l,c,d,p,f,g),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(t){this[12]=t}set y(t){this[13]=t}set z(t){this[14]=t}set w(t){this[15]=t}set(t,e,r,i,n,s,a,o,h,u,l,c,d,p,f,g){return t.length?this.copy(t):(function(t,e,r,i,n,s,a,o,h,u,l,c,d,p,f,g,m){t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=a,t[6]=o,t[7]=h,t[8]=u,t[9]=l,t[10]=c,t[11]=d,t[12]=p,t[13]=f,t[14]=g,t[15]=m}(this,t,e,r,i,n,s,a,o,h,u,l,c,d,p,f,g),this)}translate(t,e=this){return function(t,e,r){let i,n,s,a,o,h,u,l,c,d,p,f,g=r[0],m=r[1],v=r[2];e===t?(t[12]=e[0]*g+e[4]*m+e[8]*v+e[12],t[13]=e[1]*g+e[5]*m+e[9]*v+e[13],t[14]=e[2]*g+e[6]*m+e[10]*v+e[14],t[15]=e[3]*g+e[7]*m+e[11]*v+e[15]):(i=e[0],n=e[1],s=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=e[9],p=e[10],f=e[11],t[0]=i,t[1]=n,t[2]=s,t[3]=a,t[4]=o,t[5]=h,t[6]=u,t[7]=l,t[8]=c,t[9]=d,t[10]=p,t[11]=f,t[12]=i*g+o*m+c*v+e[12],t[13]=n*g+h*m+d*v+e[13],t[14]=s*g+u*m+p*v+e[14],t[15]=a*g+l*m+f*v+e[15])}(this,e,t),this}rotate(t,e,r=this){return function(t,e,r,i){let n,s,a,o,h,u,l,c,d,p,f,g,m,v,y,w,b,x,E,_,M,A,T,S,F=i[0],O=i[1],R=i[2],C=Math.hypot(F,O,R);Math.abs(C)<1e-6||(C=1/C,F*=C,O*=C,R*=C,n=Math.sin(r),s=Math.cos(r),a=1-s,o=e[0],h=e[1],u=e[2],l=e[3],c=e[4],d=e[5],p=e[6],f=e[7],g=e[8],m=e[9],v=e[10],y=e[11],w=F*F*a+s,b=O*F*a+R*n,x=R*F*a-O*n,E=F*O*a-R*n,_=O*O*a+s,M=R*O*a+F*n,A=F*R*a+O*n,T=O*R*a-F*n,S=R*R*a+s,t[0]=o*w+c*b+g*x,t[1]=h*w+d*b+m*x,t[2]=u*w+p*b+v*x,t[3]=l*w+f*b+y*x,t[4]=o*E+c*_+g*M,t[5]=h*E+d*_+m*M,t[6]=u*E+p*_+v*M,t[7]=l*E+f*_+y*M,t[8]=o*A+c*T+g*S,t[9]=h*A+d*T+m*S,t[10]=u*A+p*T+v*S,t[11]=l*A+f*T+y*S,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,r,t,e),this}scale(t,e=this){return function(t,e,r){let i=r[0],n=r[1],s=r[2];t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this,e,"number"==typeof t?[t,t,t]:t),this}multiply(t,e){return e?Ue(this,t,e):Ue(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}copy(t){var e,r;return r=t,(e=this)[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this}fromPerspective({fov:t,aspect:e,near:r,far:i}={}){return function(t,e,r,i,n){let s=1/Math.tan(e/2),a=1/(i-n);t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+i)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*i*a,t[15]=0}(this,t,e,r,i),this}fromOrthogonal({left:t,right:e,bottom:r,top:i,near:n,far:s}){return function(t,e,r,i,n,s,a){let o=1/(e-r),h=1/(i-n),u=1/(s-a);t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*o,t[13]=(n+i)*h,t[14]=(a+s)*u,t[15]=1}(this,t,e,r,i,n,s),this}fromQuaternion(t){return function(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=r+r,o=i+i,h=n+n,u=r*a,l=i*a,c=i*o,d=n*a,p=n*o,f=n*h,g=s*a,m=s*o,v=s*h;t[0]=1-c-f,t[1]=l+v,t[2]=d-m,t[3]=0,t[4]=l-v,t[5]=1-u-f,t[6]=p+g,t[7]=0,t[8]=d+m,t[9]=p-g,t[10]=1-u-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this}setPosition(t){return this.x=t[0],this.y=t[1],this.z=t[2],this}inverse(t=this){return function(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],h=e[6],u=e[7],l=e[8],c=e[9],d=e[10],p=e[11],f=e[12],g=e[13],m=e[14],v=e[15],y=r*o-i*a,w=r*h-n*a,b=r*u-s*a,x=i*h-n*o,E=i*u-s*o,_=n*u-s*h,M=l*g-c*f,A=l*m-d*f,T=l*v-p*f,S=c*m-d*g,F=c*v-p*g,O=d*v-p*m,R=y*O-w*F+b*S+x*T-E*A+_*M;R&&(R=1/R,t[0]=(o*O-h*F+u*S)*R,t[1]=(n*F-i*O-s*S)*R,t[2]=(g*_-m*E+v*x)*R,t[3]=(d*E-c*_-p*x)*R,t[4]=(h*T-a*O-u*A)*R,t[5]=(r*O-n*T+s*A)*R,t[6]=(m*b-f*_-v*w)*R,t[7]=(l*_-d*b+p*w)*R,t[8]=(a*F-o*T+u*M)*R,t[9]=(i*T-r*F-s*M)*R,t[10]=(f*E-g*b+v*y)*R,t[11]=(c*b-l*E-p*y)*R,t[12]=(o*A-a*S-h*M)*R,t[13]=(r*S-i*A+n*M)*R,t[14]=(g*w-f*x-m*y)*R,t[15]=(l*x-c*w+d*y)*R)}(this,t),this}compose(t,e,r){return function(t,e,r,i){let n=e[0],s=e[1],a=e[2],o=e[3],h=n+n,u=s+s,l=a+a,c=n*h,d=n*u,p=n*l,f=s*u,g=s*l,m=a*l,v=o*h,y=o*u,w=o*l,b=i[0],x=i[1],E=i[2];t[0]=(1-(f+m))*b,t[1]=(d+w)*b,t[2]=(p-y)*b,t[3]=0,t[4]=(d-w)*x,t[5]=(1-(c+m))*x,t[6]=(g+v)*x,t[7]=0,t[8]=(p+y)*E,t[9]=(g-v)*E,t[10]=(1-(c+f))*E,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1}(this,t,e,r),this}getRotation(t){return je(t,this),this}getTranslation(t){var e,r;return r=this,(e=t)[0]=r[12],e[1]=r[13],e[2]=r[14],this}getScaling(t){return Ie(t,this),this}getMaxScaleOnAxis(){return function(t){let e=t[0],r=t[1],i=t[2],n=t[4],s=t[5],a=t[6],o=t[8],h=t[9],u=t[10];const l=e*e+r*r+i*i,c=n*n+s*s+a*a,d=o*o+h*h+u*u;return Math.sqrt(Math.max(l,c,d))}(this)}lookAt(t,e,r){return function(t,e,r,i){let n=e[0],s=e[1],a=e[2],o=i[0],h=i[1],u=i[2],l=n-r[0],c=s-r[1],d=a-r[2],p=l*l+c*c+d*d;0===p?d=1:(p=1/Math.sqrt(p),l*=p,c*=p,d*=p);let f=h*d-u*c,g=u*l-o*d,m=o*c-h*l;p=f*f+g*g+m*m,0===p&&(u?o+=1e-6:h?u+=1e-6:h+=1e-6,f=h*d-u*c,g=u*l-o*d,m=o*c-h*l,p=f*f+g*g+m*m),p=1/Math.sqrt(p),f*=p,g*=p,m*=p,t[0]=f,t[1]=g,t[2]=m,t[3]=0,t[4]=c*m-d*g,t[5]=d*f-l*m,t[6]=l*g-c*f,t[7]=0,t[8]=l,t[9]=c,t[10]=d,t[11]=0,t[12]=n,t[13]=s,t[14]=a,t[15]=1}(this,t,e,r),this}determinant(){return function(t){let e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],a=t[5],o=t[6],h=t[7],u=t[8],l=t[9],c=t[10],d=t[11],p=t[12],f=t[13],g=t[14],m=t[15];return(e*a-r*s)*(c*m-d*g)-(e*o-i*s)*(l*m-d*f)+(e*h-n*s)*(l*g-c*f)+(r*o-i*a)*(u*m-d*p)-(r*h-n*a)*(u*g-c*p)+(i*h-n*o)*(u*f-l*p)}(this)}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this[4]=t[e+4],this[5]=t[e+5],this[6]=t[e+6],this[7]=t[e+7],this[8]=t[e+8],this[9]=t[e+9],this[10]=t[e+10],this[11]=t[e+11],this[12]=t[e+12],this[13]=t[e+13],this[14]=t[e+14],this[15]=t[e+15],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t[e+4]=this[4],t[e+5]=this[5],t[e+6]=this[6],t[e+7]=this[7],t[e+8]=this[8],t[e+9]=this[9],t[e+10]=this[10],t[e+11]=this[11],t[e+12]=this[12],t[e+13]=this[13],t[e+14]=this[14],t[e+15]=this[15],t}}const Ye=new ke;class qe extends Array{constructor(t=0,e=t,r=t,i="YXZ"){return super(t,e,r),this.order=i,this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t,this.onChange()}set y(t){this[1]=t,this.onChange()}set z(t){this[2]=t,this.onChange()}set(t,e=t,r=t){return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=r,this.onChange(),this)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.onChange(),this}reorder(t){return this.order=t,this.onChange(),this}fromRotationMatrix(t,e=this.order){return function(t,e,r="YXZ"){"XYZ"===r?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):"YXZ"===r?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):"ZXY"===r?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):"ZYX"===r?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):"YZX"===r?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):"XZY"===r&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0))}(this,t,e),this.onChange(),this}fromQuaternion(t,e=this.order){return Ye.fromQuaternion(t),this.fromRotationMatrix(Ye,e)}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}}class Xe{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new ke,this.worldMatrix=new ke,this.matrixAutoUpdate=!0,this.position=new me,this.quaternion=new ze,this.scale=new me(1),this.rotation=new qe,this.up=new me(0,1,0),this.rotation.onChange=()=>this.quaternion.fromEuler(this.rotation),this.quaternion.onChange=()=>this.rotation.fromQuaternion(this.quaternion)}setParent(t,e=!0){this.parent&&t!==this.parent&&this.parent.removeChild(this,!1),this.parent=t,e&&t&&t.addChild(this,!1)}addChild(t,e=!0){~this.children.indexOf(t)||this.children.push(t),e&&t.setParent(this,!1)}removeChild(t,e=!0){~this.children.indexOf(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(let e=0,r=this.children.length;e<r;e++)this.children[e].updateMatrixWorld(t)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(t){if(!t(this))for(let e=0,r=this.children.length;e<r;e++)this.children[e].traverse(t)}decompose(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(t,e=!1){e?this.matrix.lookAt(this.position,t,this.up):this.matrix.lookAt(t,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}}const We=new ke,Ge=new me,He=new me;class Ve extends Xe{constructor(t,{near:e=.1,far:r=100,fov:i=45,aspect:n=1,left:s,right:a,bottom:o,top:h,zoom:u=1}={}){super(),Object.assign(this,{near:e,far:r,fov:i,aspect:n,left:s,right:a,bottom:o,top:h,zoom:u}),this.projectionMatrix=new ke,this.viewMatrix=new ke,this.projectionViewMatrix=new ke,this.worldPosition=new me,this.type=s||a?"orthographic":"perspective","orthographic"===this.type?this.orthographic():this.perspective()}perspective({near:t=this.near,far:e=this.far,fov:r=this.fov,aspect:i=this.aspect}={}){return Object.assign(this,{near:t,far:e,fov:r,aspect:i}),this.projectionMatrix.fromPerspective({fov:r*(Math.PI/180),aspect:i,near:t,far:e}),this.type="perspective",this}orthographic({near:t=this.near,far:e=this.far,left:r=this.left,right:i=this.right,bottom:n=this.bottom,top:s=this.top,zoom:a=this.zoom}={}){return Object.assign(this,{near:t,far:e,left:r,right:i,bottom:n,top:s,zoom:a}),r/=a,i/=a,n/=a,s/=a,this.projectionMatrix.fromOrthogonal({left:r,right:i,bottom:n,top:s,near:t,far:e}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(t){return super.lookAt(t,!0),this}project(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this}unproject(t){return t.applyMatrix4(We.inverse(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new me,new me,new me,new me,new me,new me]);const t=this.projectionViewMatrix;this.frustum[0].set(t[3]-t[0],t[7]-t[4],t[11]-t[8]).constant=t[15]-t[12],this.frustum[1].set(t[3]+t[0],t[7]+t[4],t[11]+t[8]).constant=t[15]+t[12],this.frustum[2].set(t[3]+t[1],t[7]+t[5],t[11]+t[9]).constant=t[15]+t[13],this.frustum[3].set(t[3]-t[1],t[7]-t[5],t[11]-t[9]).constant=t[15]-t[13],this.frustum[4].set(t[3]-t[2],t[7]-t[6],t[11]-t[10]).constant=t[15]-t[14],this.frustum[5].set(t[3]+t[2],t[7]+t[6],t[11]+t[10]).constant=t[15]+t[14];for(let t=0;t<6;t++){const e=1/this.frustum[t].distance();this.frustum[t].multiply(e),this.frustum[t].constant*=e}}frustumIntersectsMesh(t,e=t.worldMatrix){if(!t.geometry.attributes.position)return!0;if(t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere(),!t.geometry.bounds)return!0;const r=Ge;r.copy(t.geometry.bounds.center),r.applyMatrix4(e);const i=t.geometry.bounds.radius*e.getMaxScaleOnAxis();return this.frustumIntersectsSphere(r,i)}frustumIntersectsSphere(t,e){const r=He;for(let i=0;i<6;i++){const n=this.frustum[i];if(r.copy(n).dot(t)+n.constant<-e)return!1}return!0}}function $e(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=r[0],p=r[1],f=r[2],g=r[3],m=r[4],v=r[5],y=r[6],w=r[7],b=r[8];return t[0]=d*i+p*a+f*u,t[1]=d*n+p*o+f*l,t[2]=d*s+p*h+f*c,t[3]=g*i+m*a+v*u,t[4]=g*n+m*o+v*l,t[5]=g*s+m*h+v*c,t[6]=y*i+w*a+b*u,t[7]=y*n+w*o+b*l,t[8]=y*s+w*h+b*c,t}class Qe extends Array{constructor(t=1,e=0,r=0,i=0,n=1,s=0,a=0,o=0,h=1){return super(t,e,r,i,n,s,a,o,h),this}set(t,e,r,i,n,s,a,o,h){return t.length?this.copy(t):(function(t,e,r,i,n,s,a,o,h,u){t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=a,t[6]=o,t[7]=h,t[8]=u}(this,t,e,r,i,n,s,a,o,h),this)}translate(t,e=this){return function(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=r[0],p=r[1];t[0]=i,t[1]=n,t[2]=s,t[3]=a,t[4]=o,t[5]=h,t[6]=d*i+p*a+u,t[7]=d*n+p*o+l,t[8]=d*s+p*h+c}(this,e,t),this}rotate(t,e=this){return function(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=Math.sin(r),p=Math.cos(r);t[0]=p*i+d*a,t[1]=p*n+d*o,t[2]=p*s+d*h,t[3]=p*a-d*i,t[4]=p*o-d*n,t[5]=p*h-d*s,t[6]=u,t[7]=l,t[8]=c}(this,e,t),this}scale(t,e=this){return function(t,e,r){let i=r[0],n=r[1];t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]}(this,e,t),this}multiply(t,e){return e?$e(this,t,e):$e(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}copy(t){var e,r;return r=t,(e=this)[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this}fromMatrix4(t){var e,r;return r=t,(e=this)[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[4],e[4]=r[5],e[5]=r[6],e[6]=r[8],e[7]=r[9],e[8]=r[10],this}fromQuaternion(t){return function(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=r+r,o=i+i,h=n+n,u=r*a,l=i*a,c=i*o,d=n*a,p=n*o,f=n*h,g=s*a,m=s*o,v=s*h;t[0]=1-c-f,t[3]=l-v,t[6]=d+m,t[1]=l+v,t[4]=1-u-f,t[7]=p-g,t[2]=d-m,t[5]=p+g,t[8]=1-u-c}(this,t),this}fromBasis(t,e,r){return this.set(t[0],t[1],t[2],e[0],e[1],e[2],r[0],r[1],r[2]),this}inverse(t=this){return function(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],h=e[6],u=e[7],l=e[8],c=l*a-o*u,d=-l*s+o*h,p=u*s-a*h,f=r*c+i*d+n*p;f&&(f=1/f,t[0]=c*f,t[1]=(-l*i+n*u)*f,t[2]=(o*i-n*a)*f,t[3]=d*f,t[4]=(l*r-n*h)*f,t[5]=(-o*r+n*s)*f,t[6]=p*f,t[7]=(-u*r+i*h)*f,t[8]=(a*r-i*s)*f)}(this,t),this}getNormalMatrix(t){return function(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],h=e[6],u=e[7],l=e[8],c=e[9],d=e[10],p=e[11],f=e[12],g=e[13],m=e[14],v=e[15],y=r*o-i*a,w=r*h-n*a,b=r*u-s*a,x=i*h-n*o,E=i*u-s*o,_=n*u-s*h,M=l*g-c*f,A=l*m-d*f,T=l*v-p*f,S=c*m-d*g,F=c*v-p*g,O=d*v-p*m,R=y*O-w*F+b*S+x*T-E*A+_*M;R&&(R=1/R,t[0]=(o*O-h*F+u*S)*R,t[1]=(h*T-a*O-u*A)*R,t[2]=(a*F-o*T+u*M)*R,t[3]=(n*F-i*O-s*S)*R,t[4]=(r*O-n*T+s*A)*R,t[5]=(i*T-r*F-s*M)*R,t[6]=(g*_-m*E+v*x)*R,t[7]=(m*b-f*_-v*w)*R,t[8]=(f*E-g*b+v*y)*R)}(this,t),this}}let Ze=0;class Ke extends Xe{constructor(t,{geometry:e,program:r,mode:i=t.TRIANGLES,frustumCulled:n=!0,renderOrder:s=0}={}){super(),t.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=t,this.id=Ze++,this.geometry=e,this.program=r,this.mode=i,this.frustumCulled=n,this.renderOrder=s,this.modelViewMatrix=new ke,this.normalMatrix=new Qe,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(t){return this.beforeRenderCallbacks.push(t),this}onAfterRender(t){return this.afterRenderCallbacks.push(t),this}draw({camera:t}={}){this.beforeRenderCallbacks.forEach((e=>e&&e({mesh:this,camera:t}))),t&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=t.projectionMatrix,this.program.uniforms.cameraPosition.value=t.worldPosition,this.program.uniforms.viewMatrix.value=t.viewMatrix,this.modelViewMatrix.multiply(t.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix);let e=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:e}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach((e=>e&&e({mesh:this,camera:t})))}}const Je=new Uint8Array(4);function tr(t){return 0==(t&t-1)}let er=1;class rr{constructor(t,{image:e,target:r=t.TEXTURE_2D,type:i=t.UNSIGNED_BYTE,format:n=t.RGBA,internalFormat:s=n,wrapS:a=t.CLAMP_TO_EDGE,wrapT:o=t.CLAMP_TO_EDGE,generateMipmaps:h=!0,minFilter:u=(h?t.NEAREST_MIPMAP_LINEAR:t.LINEAR),magFilter:l=t.LINEAR,premultiplyAlpha:c=!1,unpackAlignment:d=4,flipY:p=r==t.TEXTURE_2D,anisotropy:f=0,level:g=0,width:m,height:v=m}={}){this.gl=t,this.id=er++,this.image=e,this.target=r,this.type=i,this.format=n,this.internalFormat=s,this.minFilter=u,this.magFilter=l,this.wrapS=a,this.wrapT=o,this.generateMipmaps=h,this.premultiplyAlpha=c,this.unpackAlignment=d,this.flipY=p,this.anisotropy=Math.min(f,this.gl.renderer.parameters.maxAnisotropy),this.level=g,this.width=m,this.height=v,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.anisotropy=0}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(t=0){const e=!(this.image===this.store.image&&!this.needsUpdate);if((e||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),e){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,this.level,this.internalFormat,this.format,this.type,this.image[t]);else if(ArrayBuffer.isView(this.image))this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);else if(this.image.isCompressedTexture)for(let t=0;t<this.image.length;t++)this.gl.compressedTexImage2D(this.target,t,this.internalFormat,this.image[t].width,this.image[t].height,0,this.image[t].data);else this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(this.gl.renderer.isWebgl2||tr(this.image.width)&&tr(this.image.height)?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR)),this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Je);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Je);this.store.image=this.image}}}class ir{constructor(t,{width:e=t.canvas.width,height:r=t.canvas.height,target:i=t.FRAMEBUFFER,color:n=1,depth:s=!0,stencil:a=!1,depthTexture:o=!1,wrapS:h=t.CLAMP_TO_EDGE,wrapT:u=t.CLAMP_TO_EDGE,minFilter:l=t.LINEAR,magFilter:c=l,type:d=t.UNSIGNED_BYTE,format:p=t.RGBA,internalFormat:f=p,unpackAlignment:g,premultiplyAlpha:m}={}){this.gl=t,this.width=e,this.height=r,this.depth=s,this.buffer=this.gl.createFramebuffer(),this.target=i,this.gl.renderer.bindFramebuffer(this),this.textures=[];const v=[];for(let i=0;i<n;i++)this.textures.push(new rr(t,{width:e,height:r,wrapS:h,wrapT:u,minFilter:l,magFilter:c,type:d,format:p,internalFormat:f,unpackAlignment:g,premultiplyAlpha:m,flipY:!1,generateMipmaps:!1})),this.textures[i].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+i,this.gl.TEXTURE_2D,this.textures[i].texture,0),v.push(this.gl.COLOR_ATTACHMENT0+i);v.length>1&&this.gl.renderer.drawBuffers(v),this.texture=this.textures[0],o&&(this.gl.renderer.isWebgl2||this.gl.renderer.getExtension("WEBGL_depth_texture"))?(this.depthTexture=new rr(t,{width:e,height:r,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,format:this.gl.DEPTH_COMPONENT,internalFormat:t.renderer.isWebgl2?this.gl.DEPTH_COMPONENT16:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT}),this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)):(s&&!a&&(this.depthBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,e,r),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.depthBuffer)),a&&!s&&(this.stencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,e,r),this.gl.framebufferRenderbuffer(this.target,this.gl.STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.stencilBuffer)),s&&a&&(this.depthStencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,e,r),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.depthStencilBuffer))),this.gl.renderer.bindFramebuffer({target:this.target})}setSize(t,e){if(this.width!==t||this.height!==e){this.width=t,this.height=e,this.gl.renderer.bindFramebuffer(this);for(let r=0;r<this.textures.length;r++)this.textures[r].width=t,this.textures[r].height=e,this.textures[r].needsUpdate=!0,this.textures[r].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+r,this.gl.TEXTURE_2D,this.textures[r].texture,0);this.depthTexture?(this.depthTexture.width=t,this.depthTexture.height=e,this.depthTexture.needsUpdate=!0,this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)):(this.depthBuffer&&(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,t,e)),this.stencilBuffer&&(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,t,e)),this.depthStencilBuffer&&(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,t,e))),this.gl.renderer.bindFramebuffer({target:this.target})}}}function nr(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function sr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function ar(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function or(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function hr(t,e){return t[0]*e[1]-t[1]*e[0]}class ur extends Array{constructor(t=0,e=t){return super(t,e),this}get x(){return this[0]}get y(){return this[1]}set x(t){this[0]=t}set y(t){this[1]=t}set(t,e=t){return t.length?this.copy(t):(function(t,e,r){t[0]=e,t[1]=r}(this,t,e),this)}copy(t){var e,r;return r=t,(e=this)[0]=r[0],e[1]=r[1],this}add(t,e){return e?nr(this,t,e):nr(this,this,t),this}sub(t,e){return e?sr(this,t,e):sr(this,this,t),this}multiply(t){var e,r,i;return t.length?(r=this,i=t,(e=this)[0]=r[0]*i[0],e[1]=r[1]*i[1]):ar(this,this,t),this}divide(t){var e,r,i;return t.length?(r=this,i=t,(e=this)[0]=r[0]/i[0],e[1]=r[1]/i[1]):ar(this,this,1/t),this}inverse(t=this){var e,r;return r=t,(e=this)[0]=1/r[0],e[1]=1/r[1],this}len(){return or(this)}distance(t){return t?(e=this,i=(r=t)[0]-e[0],n=r[1]-e[1],Math.sqrt(i*i+n*n)):or(this);var e,r,i,n}squaredLen(){return this.squaredDistance()}squaredDistance(t){return t?(e=this,i=(r=t)[0]-e[0],n=r[1]-e[1],i*i+n*n):function(t){var e=t[0],r=t[1];return e*e+r*r}(this);var e,r,i,n}negate(t=this){var e,r;return r=t,(e=this)[0]=-r[0],e[1]=-r[1],this}cross(t,e){return e?hr(t,e):hr(this,t)}scale(t){return ar(this,this,t),this}normalize(){var t,e,r,i,n;return t=this,r=(e=this)[0],i=e[1],(n=r*r+i*i)>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,this}dot(t){return r=t,(e=this)[0]*r[0]+e[1]*r[1];var e,r}equals(t){return r=t,(e=this)[0]===r[0]&&e[1]===r[1];var e,r}applyMatrix3(t){var e,r,i,n,s;return e=this,i=t,n=(r=this)[0],s=r[1],e[0]=i[0]*n+i[3]*s+i[6],e[1]=i[1]*n+i[4]*s+i[7],this}applyMatrix4(t){return function(t,e,r){let i=e[0],n=e[1];t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13]}(this,this,t),this}lerp(t,e){return function(t,e,r,i){var n=e[0],s=e[1];t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s)}(this,this,t,e),this}clone(){return new ur(this[0],this[1])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t}}class lr extends xe{constructor(t,{width:e=1,height:r=1,widthSegments:i=1,heightSegments:n=1,attributes:s={}}={}){const a=i,o=n,h=(a+1)*(o+1),u=a*o*6,l=new Float32Array(3*h),c=new Float32Array(3*h),d=new Float32Array(2*h),p=u>65536?new Uint32Array(u):new Uint16Array(u);lr.buildPlane(l,c,d,p,e,r,0,a,o),Object.assign(s,{position:{size:3,data:l},normal:{size:3,data:c},uv:{size:2,data:d},index:{data:p}}),super(t,s)}static buildPlane(t,e,r,i,n,s,a,o,h,u=0,l=1,c=2,d=1,p=-1,f=0,g=0){const m=f,v=n/o,y=s/h;for(let w=0;w<=h;w++){let b=w*y-s/2;for(let s=0;s<=o;s++,f++){let y=s*v-n/2;if(t[3*f+u]=y*d,t[3*f+l]=b*p,t[3*f+c]=a/2,e[3*f+u]=0,e[3*f+l]=0,e[3*f+c]=a>=0?1:-1,r[2*f]=s/o,r[2*f+1]=1-w/h,w===h||s===o)continue;let x=m+s+w*(o+1),E=m+s+(w+1)*(o+1),_=m+s+(w+1)*(o+1)+1,M=m+s+w*(o+1)+1;i[6*g]=x,i[6*g+1]=E,i[6*g+2]=M,i[6*g+3]=E,i[6*g+4]=_,i[6*g+5]=M,g++}}}}class cr extends xe{constructor(t,{attributes:e={}}={}){Object.assign(e,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),super(t,e)}}class dr{constructor(t,{size:e=128,falloff:r=.3,alpha:i=1,dissipation:n=.98,type:s}={}){const a=this;this.gl=t,this.uniform={value:null},this.mask={read:null,write:null,swap:()=>{let t=a.mask.read;a.mask.read=a.mask.write,a.mask.write=t,a.uniform.value=a.mask.read.texture}},function(){s||(s=t.HALF_FLOAT||t.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES);let r=t.renderer.isWebgl2||t.renderer.extensions[`OES_texture_${s===t.FLOAT?"":"half_"}float_linear`]?t.LINEAR:t.NEAREST;const i={width:e,height:e,type:s,format:t.RGBA,internalFormat:t.renderer.isWebgl2?s===t.FLOAT?t.RGBA32F:t.RGBA16F:t.RGBA,minFilter:r,depth:!1};a.mask.read=new ir(t,i),a.mask.write=new ir(t,i),a.mask.swap()}(),this.aspect=1,this.mouse=new ur,this.velocity=new ur,this.mesh=new Ke(t,{geometry:new cr(t),program:new Me(t,{vertex:pr,fragment:fr,uniforms:{tMap:a.uniform,uFalloff:{value:.5*r},uAlpha:{value:i},uDissipation:{value:n},uAspect:{value:1},uMouse:{value:a.mouse},uVelocity:{value:a.velocity}},depthTest:!1})})}update(){this.mesh.program.uniforms.uAspect.value=this.aspect,this.gl.renderer.render({scene:this.mesh,target:this.mask.write,clear:!1}),this.mask.swap()}}const pr="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",fr="\n    precision highp float;\n\n    uniform sampler2D tMap;\n\n    uniform float uFalloff;\n    uniform float uAlpha;\n    uniform float uDissipation;\n    \n    uniform float uAspect;\n    uniform vec2 uMouse;\n    uniform vec2 uVelocity;\n\n    varying vec2 vUv;\n\n    void main() {\n        vec4 color = texture2D(tMap, vUv) * uDissipation;\n\n        vec2 cursor = vUv - uMouse;\n        cursor.x *= uAspect;\n\n        vec3 stamp = vec3(uVelocity * vec2(1, -1), 1.0 - pow(1.0 - min(1.0, length(uVelocity)), 3.0));\n        float falloff = smoothstep(uFalloff, 0.0, length(cursor)) * uAlpha;\n\n        color.rgb = mix(color.rgb, stamp, vec3(falloff));\n\n        gl_FragColor = color;\n    }\n";var gr=function(t,e){for(var r=-1,i=null==t?0:t.length,n=Array(i);++r<i;)n[r]=e(t[r],r,t);return n};var mr=function(){this.__data__=[],this.size=0};var vr=function(t,e){return t===e||t!=t&&e!=e},yr=vr;var wr=function(t,e){for(var r=t.length;r--;)if(yr(t[r][0],e))return r;return-1},br=wr,xr=Array.prototype.splice;var Er=wr;var _r=wr;var Mr=wr;var Ar=mr,Tr=function(t){var e=this.__data__,r=br(e,t);return!(r<0)&&(r==e.length-1?e.pop():xr.call(e,r,1),--this.size,!0)},Sr=function(t){var e=this.__data__,r=Er(e,t);return r<0?void 0:e[r][1]},Fr=function(t){return _r(this.__data__,t)>-1},Or=function(t,e){var r=this.__data__,i=Mr(r,t);return i<0?(++this.size,r.push([t,e])):r[i][1]=e,this};function Rr(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}Rr.prototype.clear=Ar,Rr.prototype.delete=Tr,Rr.prototype.get=Sr,Rr.prototype.has=Fr,Rr.prototype.set=Or;var Cr=Rr,Lr=Cr;var Pr=function(){this.__data__=new Lr,this.size=0};var Dr=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var Nr=function(t){return this.__data__.get(t)};var Br,zr=function(t){return this.__data__.has(t)},Ur=N["__core-js_shared__"],Ir=(Br=/[^.]+$/.exec(Ur&&Ur.keys&&Ur.keys.IE_PROTO||""))?"Symbol(src)_1."+Br:"";var jr=function(t){return!!Ir&&Ir in t},kr=Function.prototype.toString;var Yr=function(t){if(null!=t){try{return kr.call(t)}catch(t){}try{return t+""}catch(t){}}return""},qr=It,Xr=jr,Wr=Bt,Gr=Yr,Hr=/^\[object .+?Constructor\]$/,Vr=Function.prototype,$r=Object.prototype,Qr=Vr.toString,Zr=$r.hasOwnProperty,Kr=RegExp("^"+Qr.call(Zr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Jr=function(t){return!(!Wr(t)||Xr(t))&&(qr(t)?Kr:Hr).test(Gr(t))},ti=function(t,e){return null==t?void 0:t[e]};var ei=function(t,e){var r=ti(t,e);return Jr(r)?r:void 0},ri=ei(N,"Map"),ii=ei(Object,"create"),ni=ii;var si=function(){this.__data__=ni?ni(null):{},this.size=0};var ai=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},oi=ii,hi=Object.prototype.hasOwnProperty;var ui=function(t){var e=this.__data__;if(oi){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return hi.call(e,t)?e[t]:void 0},li=ii,ci=Object.prototype.hasOwnProperty;var di=ii;var pi=si,fi=ai,gi=ui,mi=function(t){var e=this.__data__;return li?void 0!==e[t]:ci.call(e,t)},vi=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=di&&void 0===e?"__lodash_hash_undefined__":e,this};function yi(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}yi.prototype.clear=pi,yi.prototype.delete=fi,yi.prototype.get=gi,yi.prototype.has=mi,yi.prototype.set=vi;var wi=yi,bi=Cr,xi=ri;var Ei=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var _i=function(t,e){var r=t.__data__;return Ei(e)?r["string"==typeof e?"string":"hash"]:r.map},Mi=_i;var Ai=_i;var Ti=_i;var Si=_i;var Fi=function(){this.size=0,this.__data__={hash:new wi,map:new(xi||bi),string:new wi}},Oi=function(t){var e=Mi(this,t).delete(t);return this.size-=e?1:0,e},Ri=function(t){return Ai(this,t).get(t)},Ci=function(t){return Ti(this,t).has(t)},Li=function(t,e){var r=Si(this,t),i=r.size;return r.set(t,e),this.size+=r.size==i?0:1,this};function Pi(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}Pi.prototype.clear=Fi,Pi.prototype.delete=Oi,Pi.prototype.get=Ri,Pi.prototype.has=Ci,Pi.prototype.set=Li;var Di=Pi,Ni=Cr,Bi=ri,zi=Di;var Ui=Cr,Ii=Pr,ji=Dr,ki=Nr,Yi=zr,qi=function(t,e){var r=this.__data__;if(r instanceof Ni){var i=r.__data__;if(!Bi||i.length<199)return i.push([t,e]),this.size=++r.size,this;r=this.__data__=new zi(i)}return r.set(t,e),this.size=r.size,this};function Xi(t){var e=this.__data__=new Ui(t);this.size=e.size}Xi.prototype.clear=Ii,Xi.prototype.delete=ji,Xi.prototype.get=ki,Xi.prototype.has=Yi,Xi.prototype.set=qi;var Wi=Xi;var Gi=Di,Hi=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Vi=function(t){return this.__data__.has(t)};function $i(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new Gi;++e<r;)this.add(t[e])}$i.prototype.add=$i.prototype.push=Hi,$i.prototype.has=Vi;var Qi=function(t,e){for(var r=-1,i=null==t?0:t.length;++r<i;)if(e(t[r],r,t))return!0;return!1};var Zi=function(t,e){return t.has(e)},Ki=$i,Ji=Qi,tn=Zi;var en=function(t,e,r,i,n,s){var a=1&r,o=t.length,h=e.length;if(o!=h&&!(a&&h>o))return!1;var u=s.get(t),l=s.get(e);if(u&&l)return u==e&&l==t;var c=-1,d=!0,p=2&r?new Ki:void 0;for(s.set(t,e),s.set(e,t);++c<o;){var f=t[c],g=e[c];if(i)var m=a?i(g,f,c,e,t,s):i(f,g,c,t,e,s);if(void 0!==m){if(m)continue;d=!1;break}if(p){if(!Ji(e,(function(t,e){if(!tn(p,e)&&(f===t||n(f,t,r,i,s)))return p.push(e)}))){d=!1;break}}else if(f!==g&&!n(f,g,r,i,s)){d=!1;break}}return s.delete(t),s.delete(e),d};var rn=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t,i){r[++e]=[i,t]})),r};var nn=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r},sn=N.Uint8Array,an=vr,on=en,hn=rn,un=nn,ln=B?B.prototype:void 0,cn=ln?ln.valueOf:void 0;var dn=function(t,e,r,i,n,s,a){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!s(new sn(t),new sn(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return an(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var o=hn;case"[object Set]":var h=1&i;if(o||(o=un),t.size!=e.size&&!h)return!1;var u=a.get(t);if(u)return u==e;i|=2,a.set(t,e);var l=on(o(t),o(e),i,n,s,a);return a.delete(t),l;case"[object Symbol]":if(cn)return cn.call(t)==cn.call(e)}return!1};var pn=function(t,e){for(var r=-1,i=e.length,n=t.length;++r<i;)t[n+r]=e[r];return t},fn=pn,gn=it;var mn=function(t,e,r){var i=e(t);return gn(t)?i:fn(i,r(t))};var vn=function(t,e){for(var r=-1,i=null==t?0:t.length,n=0,s=[];++r<i;){var a=t[r];e(a,r,t)&&(s[n++]=a)}return s};var yn=vn,wn=function(){return[]},bn=Object.prototype.propertyIsEnumerable,xn=Object.getOwnPropertySymbols,En=mn,_n=xn?function(t){return null==t?[]:(t=Object(t),yn(xn(t),(function(e){return bn.call(t,e)})))}:wn,Mn=Gt;var An=function(t){return En(t,Mn,_n)},Tn=Object.prototype.hasOwnProperty;var Sn=function(t,e,r,i,n,s){var a=1&r,o=An(t),h=o.length;if(h!=An(e).length&&!a)return!1;for(var u=h;u--;){var l=o[u];if(!(a?l in e:Tn.call(e,l)))return!1}var c=s.get(t),d=s.get(e);if(c&&d)return c==e&&d==t;var p=!0;s.set(t,e),s.set(e,t);for(var f=a;++u<h;){var g=t[l=o[u]],m=e[l];if(i)var v=a?i(m,g,l,e,t,s):i(g,m,l,t,e,s);if(!(void 0===v?g===m||n(g,m,r,i,s):v)){p=!1;break}f||(f="constructor"==l)}if(p&&!f){var y=t.constructor,w=e.constructor;y==w||!("constructor"in t)||!("constructor"in e)||"function"==typeof y&&y instanceof y&&"function"==typeof w&&w instanceof w||(p=!1)}return s.delete(t),s.delete(e),p},Fn=ei(N,"DataView"),On=ri,Rn=ei(N,"Promise"),Cn=ei(N,"Set"),Ln=ei(N,"WeakMap"),Pn=H,Dn=Yr,Nn="[object Map]",Bn="[object Promise]",zn="[object Set]",Un="[object WeakMap]",In="[object DataView]",jn=Dn(Fn),kn=Dn(On),Yn=Dn(Rn),qn=Dn(Cn),Xn=Dn(Ln),Wn=Pn;(Fn&&Wn(new Fn(new ArrayBuffer(1)))!=In||On&&Wn(new On)!=Nn||Rn&&Wn(Rn.resolve())!=Bn||Cn&&Wn(new Cn)!=zn||Ln&&Wn(new Ln)!=Un)&&(Wn=function(t){var e=Pn(t),r="[object Object]"==e?t.constructor:void 0,i=r?Dn(r):"";if(i)switch(i){case jn:return In;case kn:return Nn;case Yn:return Bn;case qn:return zn;case Xn:return Un}return e});var Gn=Wi,Hn=en,Vn=dn,$n=Sn,Qn=Wn,Zn=it,Kn=at,Jn=xt,ts="[object Arguments]",es="[object Array]",rs="[object Object]",is=Object.prototype.hasOwnProperty;var ns=function(t,e,r,i,n,s){var a=Zn(t),o=Zn(e),h=a?es:Qn(t),u=o?es:Qn(e),l=(h=h==ts?rs:h)==rs,c=(u=u==ts?rs:u)==rs,d=h==u;if(d&&Kn(t)){if(!Kn(e))return!1;a=!0,l=!1}if(d&&!l)return s||(s=new Gn),a||Jn(t)?Hn(t,e,r,i,n,s):Vn(t,e,h,r,i,n,s);if(!(1&r)){var p=l&&is.call(t,"__wrapped__"),f=c&&is.call(e,"__wrapped__");if(p||f){var g=p?t.value():t,m=f?e.value():e;return s||(s=new Gn),n(g,m,r,i,s)}}return!!d&&(s||(s=new Gn),$n(t,e,r,i,n,s))},ss=V;var as=function t(e,r,i,n,s){return e===r||(null==e||null==r||!ss(e)&&!ss(r)?e!=e&&r!=r:ns(e,r,i,n,t,s))},os=Wi,hs=as;var us=function(t,e,r,i){var n=r.length,s=n,a=!i;if(null==t)return!s;for(t=Object(t);n--;){var o=r[n];if(a&&o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++n<s;){var h=(o=r[n])[0],u=t[h],l=o[1];if(a&&o[2]){if(void 0===u&&!(h in t))return!1}else{var c=new os;if(i)var d=i(u,l,h,t,e,c);if(!(void 0===d?hs(l,u,3,i,c):d))return!1}}return!0},ls=Bt;var cs=function(t){return t==t&&!ls(t)},ds=cs,ps=Gt;var fs=function(t){for(var e=ps(t),r=e.length;r--;){var i=e[r],n=t[i];e[r]=[i,n,ds(n)]}return e};var gs=function(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}},ms=us,vs=fs,ys=gs;var ws=function(t){var e=vs(t);return 1==e.length&&e[0][2]?ys(e[0][0],e[0][1]):function(r){return r===t||ms(r,t,e)}},bs=H,xs=V;var Es=function(t){return"symbol"==typeof t||xs(t)&&"[object Symbol]"==bs(t)},_s=it,Ms=Es,As=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ts=/^\w*$/;var Ss=function(t,e){if(_s(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!Ms(t))||(Ts.test(t)||!As.test(t)||null!=e&&t in Object(e))},Fs=Di;function Os(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var i=arguments,n=e?e.apply(this,i):i[0],s=r.cache;if(s.has(n))return s.get(n);var a=t.apply(this,i);return r.cache=s.set(n,a)||s,a};return r.cache=new(Os.Cache||Fs),r}Os.Cache=Fs;var Rs=Os;var Cs=function(t){var e=Rs(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e},Ls=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ps=/\\(\\)?/g,Ds=Cs((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Ls,(function(t,r,i,n){e.push(i?n.replace(Ps,"$1"):r||t)})),e})),Ns=gr,Bs=it,zs=Es,Us=B?B.prototype:void 0,Is=Us?Us.toString:void 0;var js=function t(e){if("string"==typeof e)return e;if(Bs(e))return Ns(e,t)+"";if(zs(e))return Is?Is.call(e):"";var r=e+"";return"0"==r&&1/e==-Infinity?"-0":r},ks=js;var Ys=it,qs=Ss,Xs=Ds,Ws=function(t){return null==t?"":ks(t)};var Gs=function(t,e){return Ys(t)?t:qs(t,e)?[t]:Xs(Ws(t))},Hs=Es;var Vs=function(t){if("string"==typeof t||Hs(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e},$s=Gs,Qs=Vs;var Zs=function(t,e){for(var r=0,i=(e=$s(e,t)).length;null!=t&&r<i;)t=t[Qs(e[r++])];return r&&r==i?t:void 0},Ks=Zs;var Js=Gs,ta=rt,ea=it,ra=ht,ia=ut,na=Vs;var sa=function(t,e,r){for(var i=-1,n=(e=Js(e,t)).length,s=!1;++i<n;){var a=na(e[i]);if(!(s=null!=t&&r(t,a)))break;t=t[a]}return s||++i!=n?s:!!(n=null==t?0:t.length)&&ia(n)&&ra(a,n)&&(ea(t)||ta(t))},aa=function(t,e){return null!=t&&e in Object(t)},oa=sa;var ha=as,ua=function(t,e,r){var i=null==t?void 0:Ks(t,e);return void 0===i?r:i},la=function(t,e){return null!=t&&oa(t,e,aa)},ca=Ss,da=cs,pa=gs,fa=Vs;var ga=Zs;var ma=function(t){return function(e){return null==e?void 0:e[t]}},va=function(t){return function(e){return ga(e,t)}},ya=Ss,wa=Vs;var ba=ws,xa=function(t,e){return ca(t)&&da(e)?pa(fa(t),e):function(r){var i=ua(r,t);return void 0===i&&i===e?la(r,t):ha(e,i,3)}},Ea=Kt,_a=it,Ma=function(t){return ya(t)?ma(wa(t)):va(t)};var Aa=Zt,Ta=Yt;var Sa=gr,Fa=function(t){return"function"==typeof t?t:null==t?Ea:"object"==typeof t?_a(t)?xa(t[0],t[1]):ba(t):Ma(t)},Oa=function(t,e){var r=-1,i=Ta(t)?Array(t.length):[];return Aa(t,(function(t,n,s){i[++r]=e(t,n,s)})),i},Ra=it;var Ca=e((function(t,e){return(Ra(t)?Sa:Oa)(t,Fa(e))})),La={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},Pa={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},Da=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],Na={CSS:{},springs:{}};function Ba(t,e,r){return Math.min(Math.max(t,e),r)}function za(t,e){return t.indexOf(e)>-1}function Ua(t,e){return t.apply(null,e)}var Ia={arr:function(t){return Array.isArray(t)},obj:function(t){return za(Object.prototype.toString.call(t),"Object")},pth:function(t){return Ia.obj(t)&&t.hasOwnProperty("totalLength")},svg:function(t){return t instanceof SVGElement},inp:function(t){return t instanceof HTMLInputElement},dom:function(t){return t.nodeType||Ia.svg(t)},str:function(t){return"string"==typeof t},fnc:function(t){return"function"==typeof t},und:function(t){return void 0===t},nil:function(t){return Ia.und(t)||null===t},hex:function(t){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)},rgb:function(t){return/^rgb/.test(t)},hsl:function(t){return/^hsl/.test(t)},col:function(t){return Ia.hex(t)||Ia.rgb(t)||Ia.hsl(t)},key:function(t){return!La.hasOwnProperty(t)&&!Pa.hasOwnProperty(t)&&"targets"!==t&&"keyframes"!==t}};function ja(t){var e=/\(([^)]+)\)/.exec(t);return e?e[1].split(",").map((function(t){return parseFloat(t)})):[]}function ka(t,e){var r=ja(t),i=Ba(Ia.und(r[0])?1:r[0],.1,100),n=Ba(Ia.und(r[1])?100:r[1],.1,100),s=Ba(Ia.und(r[2])?10:r[2],.1,100),a=Ba(Ia.und(r[3])?0:r[3],.1,100),o=Math.sqrt(n/i),h=s/(2*Math.sqrt(n*i)),u=h<1?o*Math.sqrt(1-h*h):0,l=1,c=h<1?(h*o-a)/u:-a+o;function d(t){var r=e?e*t/1e3:t;return r=h<1?Math.exp(-r*h*o)*(l*Math.cos(u*r)+c*Math.sin(u*r)):(l+c*r)*Math.exp(-r*o),0===t||1===t?t:1-r}return e?d:function(){var e=Na.springs[t];if(e)return e;for(var r=1/6,i=0,n=0;;)if(1===d(i+=r)){if(++n>=16)break}else n=0;var s=i*r*1e3;return Na.springs[t]=s,s}}function Ya(t){return void 0===t&&(t=10),function(e){return Math.ceil(Ba(e,1e-6,1)*t)*(1/t)}}var qa,Xa,Wa=function(){var t=.1;function e(t,e){return 1-3*e+3*t}function r(t,e){return 3*e-6*t}function i(t){return 3*t}function n(t,n,s){return((e(n,s)*t+r(n,s))*t+i(n))*t}function s(t,n,s){return 3*e(n,s)*t*t+2*r(n,s)*t+i(n)}return function(e,r,i,a){if(0<=e&&e<=1&&0<=i&&i<=1){var o=new Float32Array(11);if(e!==r||i!==a)for(var h=0;h<11;++h)o[h]=n(h*t,e,i);return function(t){return e===r&&i===a||0===t||1===t?t:n(u(t),r,a)}}function u(r){for(var a=0,h=1;10!==h&&o[h]<=r;++h)a+=t;--h;var u=a+(r-o[h])/(o[h+1]-o[h])*t,l=s(u,e,i);return l>=.001?function(t,e,r,i){for(var a=0;a<4;++a){var o=s(e,r,i);if(0===o)return e;e-=(n(e,r,i)-t)/o}return e}(r,u,e,i):0===l?u:function(t,e,r,i,s){var a,o,h=0;do{(a=n(o=e+(r-e)/2,i,s)-t)>0?r=o:e=o}while(Math.abs(a)>1e-7&&++h<10);return o}(r,a,a+t,e,i)}}}(),Ga=(qa={linear:function(){return function(t){return t}}},Xa={Sine:function(){return function(t){return 1-Math.cos(t*Math.PI/2)}},Circ:function(){return function(t){return 1-Math.sqrt(1-t*t)}},Back:function(){return function(t){return t*t*(3*t-2)}},Bounce:function(){return function(t){for(var e,r=4;t<((e=Math.pow(2,--r))-1)/11;);return 1/Math.pow(4,3-r)-7.5625*Math.pow((3*e-2)/22-t,2)}},Elastic:function(t,e){void 0===t&&(t=1),void 0===e&&(e=.5);var r=Ba(t,1,10),i=Ba(e,.1,2);return function(t){return 0===t||1===t?t:-r*Math.pow(2,10*(t-1))*Math.sin((t-1-i/(2*Math.PI)*Math.asin(1/r))*(2*Math.PI)/i)}}},["Quad","Cubic","Quart","Quint","Expo"].forEach((function(t,e){Xa[t]=function(){return function(t){return Math.pow(t,e+2)}}})),Object.keys(Xa).forEach((function(t){var e=Xa[t];qa["easeIn"+t]=e,qa["easeOut"+t]=function(t,r){return function(i){return 1-e(t,r)(1-i)}},qa["easeInOut"+t]=function(t,r){return function(i){return i<.5?e(t,r)(2*i)/2:1-e(t,r)(-2*i+2)/2}},qa["easeOutIn"+t]=function(t,r){return function(i){return i<.5?(1-e(t,r)(1-2*i))/2:(e(t,r)(2*i-1)+1)/2}}})),qa);function Ha(t,e){if(Ia.fnc(t))return t;var r=t.split("(")[0],i=Ga[r],n=ja(t);switch(r){case"spring":return ka(t,e);case"cubicBezier":return Ua(Wa,n);case"steps":return Ua(Ya,n);default:return Ua(i,n)}}function Va(t){try{return document.querySelectorAll(t)}catch(t){return}}function $a(t,e){for(var r=t.length,i=arguments.length>=2?arguments[1]:void 0,n=[],s=0;s<r;s++)if(s in t){var a=t[s];e.call(i,a,s,t)&&n.push(a)}return n}function Qa(t){return t.reduce((function(t,e){return t.concat(Ia.arr(e)?Qa(e):e)}),[])}function Za(t){return Ia.arr(t)?t:(Ia.str(t)&&(t=Va(t)||t),t instanceof NodeList||t instanceof HTMLCollection?[].slice.call(t):[t])}function Ka(t,e){return t.some((function(t){return t===e}))}function Ja(t){var e={};for(var r in t)e[r]=t[r];return e}function to(t,e){var r=Ja(t);for(var i in t)r[i]=e.hasOwnProperty(i)?e[i]:t[i];return r}function eo(t,e){var r=Ja(t);for(var i in e)r[i]=Ia.und(t[i])?e[i]:t[i];return r}function ro(t){return Ia.rgb(t)?(r=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e=t))?"rgba("+r[1]+",1)":e:Ia.hex(t)?function(t){var e=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(t,e,r,i){return e+e+r+r+i+i})),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return"rgba("+parseInt(r[1],16)+","+parseInt(r[2],16)+","+parseInt(r[3],16)+",1)"}(t):Ia.hsl(t)?function(t){var e,r,i,n=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(t),s=parseInt(n[1],10)/360,a=parseInt(n[2],10)/100,o=parseInt(n[3],10)/100,h=n[4]||1;function u(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t}if(0==a)e=r=i=o;else{var l=o<.5?o*(1+a):o+a-o*a,c=2*o-l;e=u(c,l,s+1/3),r=u(c,l,s),i=u(c,l,s-1/3)}return"rgba("+255*e+","+255*r+","+255*i+","+h+")"}(t):void 0;var e,r}function io(t){var e=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(t);if(e)return e[1]}function no(t,e){return Ia.fnc(t)?t(e.target,e.id,e.total):t}function so(t,e){return t.getAttribute(e)}function ao(t,e,r){if(Ka([r,"deg","rad","turn"],io(e)))return e;var i=Na.CSS[e+r];if(!Ia.und(i))return i;var n=document.createElement(t.tagName),s=t.parentNode&&t.parentNode!==document?t.parentNode:document.body;s.appendChild(n),n.style.position="absolute",n.style.width=100+r;var a=100/n.offsetWidth;s.removeChild(n);var o=a*parseFloat(e);return Na.CSS[e+r]=o,o}function oo(t,e,r){if(e in t.style){var i=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n=t.style[e]||getComputedStyle(t).getPropertyValue(i)||"0";return r?ao(t,n,r):n}}function ho(t,e){return Ia.dom(t)&&!Ia.inp(t)&&(!Ia.nil(so(t,e))||Ia.svg(t)&&t[e])?"attribute":Ia.dom(t)&&Ka(Da,e)?"transform":Ia.dom(t)&&"transform"!==e&&oo(t,e)?"css":null!=t[e]?"object":void 0}function uo(t){if(Ia.dom(t)){for(var e,r=t.style.transform||"",i=/(\w+)\(([^)]*)\)/g,n=new Map;e=i.exec(r);)n.set(e[1],e[2]);return n}}function lo(t,e,r,i){var n=za(e,"scale")?1:0+function(t){return za(t,"translate")||"perspective"===t?"px":za(t,"rotate")||za(t,"skew")?"deg":void 0}(e),s=uo(t).get(e)||n;return r&&(r.transforms.list.set(e,s),r.transforms.last=e),i?ao(t,s,i):s}function co(t,e,r,i){switch(ho(t,e)){case"transform":return lo(t,e,i,r);case"css":return oo(t,e,r);case"attribute":return so(t,e);default:return t[e]||0}}function po(t,e){var r=/^(\*=|\+=|-=)/.exec(t);if(!r)return t;var i=io(t)||0,n=parseFloat(e),s=parseFloat(t.replace(r[0],""));switch(r[0][0]){case"+":return n+s+i;case"-":return n-s+i;case"*":return n*s+i}}function fo(t,e){if(Ia.col(t))return ro(t);if(/\s/g.test(t))return t;var r=io(t),i=r?t.substr(0,t.length-r.length):t;return e?i+e:i}function go(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function mo(t){for(var e,r=t.points,i=0,n=0;n<r.numberOfItems;n++){var s=r.getItem(n);n>0&&(i+=go(e,s)),e=s}return i}function vo(t){if(t.getTotalLength)return t.getTotalLength();switch(t.tagName.toLowerCase()){case"circle":return function(t){return 2*Math.PI*so(t,"r")}(t);case"rect":return function(t){return 2*so(t,"width")+2*so(t,"height")}(t);case"line":return function(t){return go({x:so(t,"x1"),y:so(t,"y1")},{x:so(t,"x2"),y:so(t,"y2")})}(t);case"polyline":return mo(t);case"polygon":return function(t){var e=t.points;return mo(t)+go(e.getItem(e.numberOfItems-1),e.getItem(0))}(t)}}function yo(t,e){var r=e||{},i=r.el||function(t){for(var e=t.parentNode;Ia.svg(e)&&Ia.svg(e.parentNode);)e=e.parentNode;return e}(t),n=i.getBoundingClientRect(),s=so(i,"viewBox"),a=n.width,o=n.height,h=r.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:i,viewBox:h,x:h[0]/1,y:h[1]/1,w:a,h:o,vW:h[2],vH:h[3]}}function wo(t,e,r){function i(r){void 0===r&&(r=0);var i=e+r>=1?e+r:0;return t.el.getPointAtLength(i)}var n=yo(t.el,t.svg),s=i(),a=i(-1),o=i(1),h=r?1:n.w/n.vW,u=r?1:n.h/n.vH;switch(t.property){case"x":return(s.x-n.x)*h;case"y":return(s.y-n.y)*u;case"angle":return 180*Math.atan2(o.y-a.y,o.x-a.x)/Math.PI}}function bo(t,e){var r=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,i=fo(Ia.pth(t)?t.totalLength:t,e)+"";return{original:i,numbers:i.match(r)?i.match(r).map(Number):[0],strings:Ia.str(t)||e?i.split(r):[]}}function xo(t){return $a(t?Qa(Ia.arr(t)?t.map(Za):Za(t)):[],(function(t,e,r){return r.indexOf(t)===e}))}function Eo(t){var e=xo(t);return e.map((function(t,r){return{target:t,id:r,total:e.length,transforms:{list:uo(t)}}}))}function _o(t,e){var r=Ja(e);if(/^spring/.test(r.easing)&&(r.duration=ka(r.easing)),Ia.arr(t)){var i=t.length;2===i&&!Ia.obj(t[0])?t={value:t}:Ia.fnc(e.duration)||(r.duration=e.duration/i)}var n=Ia.arr(t)?t:[t];return n.map((function(t,r){var i=Ia.obj(t)&&!Ia.pth(t)?t:{value:t};return Ia.und(i.delay)&&(i.delay=r?0:e.delay),Ia.und(i.endDelay)&&(i.endDelay=r===n.length-1?e.endDelay:0),i})).map((function(t){return eo(t,r)}))}function Mo(t,e){var r=[],i=e.keyframes;for(var n in i&&(e=eo(function(t){for(var e=$a(Qa(t.map((function(t){return Object.keys(t)}))),(function(t){return Ia.key(t)})).reduce((function(t,e){return t.indexOf(e)<0&&t.push(e),t}),[]),r={},i=function(i){var n=e[i];r[n]=t.map((function(t){var e={};for(var r in t)Ia.key(r)?r==n&&(e.value=t[r]):e[r]=t[r];return e}))},n=0;n<e.length;n++)i(n);return r}(i),e)),e)Ia.key(n)&&r.push({name:n,tweens:_o(e[n],t)});return r}function Ao(t,e){var r;return t.tweens.map((function(i){var n=function(t,e){var r={};for(var i in t){var n=no(t[i],e);Ia.arr(n)&&1===(n=n.map((function(t){return no(t,e)}))).length&&(n=n[0]),r[i]=n}return r.duration=parseFloat(r.duration),r.delay=parseFloat(r.delay),r}(i,e),s=n.value,a=Ia.arr(s)?s[1]:s,o=io(a),h=co(e.target,t.name,o,e),u=r?r.to.original:h,l=Ia.arr(s)?s[0]:u,c=io(l)||io(h),d=o||c;return Ia.und(a)&&(a=u),n.from=bo(l,d),n.to=bo(po(a,l),d),n.start=r?r.end:0,n.end=n.start+n.delay+n.duration+n.endDelay,n.easing=Ha(n.easing,n.duration),n.isPath=Ia.pth(s),n.isPathTargetInsideSVG=n.isPath&&Ia.svg(e.target),n.isColor=Ia.col(n.from.original),n.isColor&&(n.round=1),r=n,n}))}var To={css:function(t,e,r){return t.style[e]=r},attribute:function(t,e,r){return t.setAttribute(e,r)},object:function(t,e,r){return t[e]=r},transform:function(t,e,r,i,n){if(i.list.set(e,r),e===i.last||n){var s="";i.list.forEach((function(t,e){s+=e+"("+t+") "})),t.style.transform=s}}};function So(t,e){Eo(t).forEach((function(t){for(var r in e){var i=no(e[r],t),n=t.target,s=io(i),a=co(n,r,s,t),o=po(fo(i,s||io(a)),a),h=ho(n,r);To[h](n,r,o,t.transforms,!0)}}))}function Fo(t,e){return $a(Qa(t.map((function(t){return e.map((function(e){return function(t,e){var r=ho(t.target,e.name);if(r){var i=Ao(e,t),n=i[i.length-1];return{type:r,property:e.name,animatable:t,tweens:i,duration:n.end,delay:i[0].delay,endDelay:n.endDelay}}}(t,e)}))}))),(function(t){return!Ia.und(t)}))}function Oo(t,e){var r=t.length,i=function(t){return t.timelineOffset?t.timelineOffset:0},n={};return n.duration=r?Math.max.apply(Math,t.map((function(t){return i(t)+t.duration}))):e.duration,n.delay=r?Math.min.apply(Math,t.map((function(t){return i(t)+t.delay}))):e.delay,n.endDelay=r?n.duration-Math.max.apply(Math,t.map((function(t){return i(t)+t.duration-t.endDelay}))):e.endDelay,n}var Ro=0;var Co=[],Lo=function(){var t;function e(r){for(var i=Co.length,n=0;n<i;){var s=Co[n];s.paused?(Co.splice(n,1),i--):(s.tick(r),n++)}t=n>0?requestAnimationFrame(e):void 0}return"undefined"!=typeof document&&document.addEventListener("visibilitychange",(function(){Do.suspendWhenDocumentHidden&&(Po()?t=cancelAnimationFrame(t):(Co.forEach((function(t){return t._onDocumentVisibility()})),Lo()))})),function(){t||Po()&&Do.suspendWhenDocumentHidden||!(Co.length>0)||(t=requestAnimationFrame(e))}}();function Po(){return!!document&&document.hidden}function Do(t){void 0===t&&(t={});var e,r=0,i=0,n=0,s=0,a=null;function o(t){var e=window.Promise&&new Promise((function(t){return a=t}));return t.finished=e,e}var h=function(t){var e=to(La,t),r=to(Pa,t),i=Mo(r,t),n=Eo(t.targets),s=Fo(n,i),a=Oo(s,r),o=Ro;return Ro++,eo(e,{id:o,children:[],animatables:n,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay})}(t);function u(){var t=h.direction;"alternate"!==t&&(h.direction="normal"!==t?"normal":"reverse"),h.reversed=!h.reversed,e.forEach((function(t){return t.reversed=h.reversed}))}function l(t){return h.reversed?h.duration-t:t}function c(){r=0,i=l(h.currentTime)*(1/Do.speed)}function d(t,e){e&&e.seek(t-e.timelineOffset)}function p(t){for(var e=0,r=h.animations,i=r.length;e<i;){var n=r[e],s=n.animatable,a=n.tweens,o=a.length-1,u=a[o];o&&(u=$a(a,(function(e){return t<e.end}))[0]||u);for(var l=Ba(t-u.start-u.delay,0,u.duration)/u.duration,c=isNaN(l)?1:u.easing(l),d=u.to.strings,p=u.round,f=[],g=u.to.numbers.length,m=void 0,v=0;v<g;v++){var y=void 0,w=u.to.numbers[v],b=u.from.numbers[v]||0;y=u.isPath?wo(u.value,c*w,u.isPathTargetInsideSVG):b+c*(w-b),p&&(u.isColor&&v>2||(y=Math.round(y*p)/p)),f.push(y)}var x=d.length;if(x){m=d[0];for(var E=0;E<x;E++){d[E];var _=d[E+1],M=f[E];isNaN(M)||(m+=_?M+_:M+" ")}}else m=f[0];To[n.type](s.target,n.property,m,s.transforms),n.currentValue=m,e++}}function f(t){h[t]&&!h.passThrough&&h[t](h)}function g(t){var c=h.duration,g=h.delay,m=c-h.endDelay,v=l(t);h.progress=Ba(v/c*100,0,100),h.reversePlayback=v<h.currentTime,e&&function(t){if(h.reversePlayback)for(var r=s;r--;)d(t,e[r]);else for(var i=0;i<s;i++)d(t,e[i])}(v),!h.began&&h.currentTime>0&&(h.began=!0,f("begin")),!h.loopBegan&&h.currentTime>0&&(h.loopBegan=!0,f("loopBegin")),v<=g&&0!==h.currentTime&&p(0),(v>=m&&h.currentTime!==c||!c)&&p(c),v>g&&v<m?(h.changeBegan||(h.changeBegan=!0,h.changeCompleted=!1,f("changeBegin")),f("change"),p(v)):h.changeBegan&&(h.changeCompleted=!0,h.changeBegan=!1,f("changeComplete")),h.currentTime=Ba(v,0,c),h.began&&f("update"),t>=c&&(i=0,h.remaining&&!0!==h.remaining&&h.remaining--,h.remaining?(r=n,f("loopComplete"),h.loopBegan=!1,"alternate"===h.direction&&u()):(h.paused=!0,h.completed||(h.completed=!0,f("loopComplete"),f("complete"),!h.passThrough&&"Promise"in window&&(a(),o(h)))))}return o(h),h.reset=function(){var t=h.direction;h.passThrough=!1,h.currentTime=0,h.progress=0,h.paused=!0,h.began=!1,h.loopBegan=!1,h.changeBegan=!1,h.completed=!1,h.changeCompleted=!1,h.reversePlayback=!1,h.reversed="reverse"===t,h.remaining=h.loop,e=h.children;for(var r=s=e.length;r--;)h.children[r].reset();(h.reversed&&!0!==h.loop||"alternate"===t&&1===h.loop)&&h.remaining++,p(h.reversed?h.duration:0)},h._onDocumentVisibility=c,h.set=function(t,e){return So(t,e),h},h.tick=function(t){n=t,r||(r=n),g((n+(i-r))*Do.speed)},h.seek=function(t){g(l(t))},h.pause=function(){h.paused=!0,c()},h.play=function(){h.paused&&(h.completed&&h.reset(),h.paused=!1,Co.push(h),c(),Lo())},h.reverse=function(){u(),h.completed=!h.reversed,c()},h.restart=function(){h.reset(),h.play()},h.remove=function(t){Bo(xo(t),h)},h.reset(),h.autoplay&&h.play(),h}function No(t,e){for(var r=e.length;r--;)Ka(t,e[r].animatable.target)&&e.splice(r,1)}function Bo(t,e){var r=e.animations,i=e.children;No(t,r);for(var n=i.length;n--;){var s=i[n],a=s.animations;No(t,a),a.length||s.children.length||i.splice(n,1)}r.length||i.length||e.pause()}Do.version="3.2.1",Do.speed=1,Do.suspendWhenDocumentHidden=!0,Do.running=Co,Do.remove=function(t){for(var e=xo(t),r=Co.length;r--;){Bo(e,Co[r])}},Do.get=co,Do.set=So,Do.convertPx=ao,Do.path=function(t,e){var r=Ia.str(t)?Va(t)[0]:t,i=e||100;return function(t){return{property:t,el:r,svg:yo(r),totalLength:vo(r)*(i/100)}}},Do.setDashoffset=function(t){var e=vo(t);return t.setAttribute("stroke-dasharray",e),e},Do.stagger=function(t,e){void 0===e&&(e={});var r=e.direction||"normal",i=e.easing?Ha(e.easing):null,n=e.grid,s=e.axis,a=e.from||0,o="first"===a,h="center"===a,u="last"===a,l=Ia.arr(t),c=l?parseFloat(t[0]):parseFloat(t),d=l?parseFloat(t[1]):0,p=io(l?t[1]:t)||0,f=e.start||0+(l?c:0),g=[],m=0;return function(t,e,v){if(o&&(a=0),h&&(a=(v-1)/2),u&&(a=v-1),!g.length){for(var y=0;y<v;y++){if(n){var w=h?(n[0]-1)/2:a%n[0],b=h?(n[1]-1)/2:Math.floor(a/n[0]),x=w-y%n[0],E=b-Math.floor(y/n[0]),_=Math.sqrt(x*x+E*E);"x"===s&&(_=-x),"y"===s&&(_=-E),g.push(_)}else g.push(Math.abs(a-y));m=Math.max.apply(Math,g)}i&&(g=g.map((function(t){return i(t/m)*m}))),"reverse"===r&&(g=g.map((function(t){return s?t<0?-1*t:-t:Math.abs(m-t)})))}return f+(l?(d-c)/m:c)*(Math.round(100*g[e])/100)+p}},Do.timeline=function(t){void 0===t&&(t={});var e=Do(t);return e.duration=0,e.add=function(r,i){var n=Co.indexOf(e),s=e.children;function a(t){t.passThrough=!0}n>-1&&Co.splice(n,1);for(var o=0;o<s.length;o++)a(s[o]);var h=eo(r,to(Pa,t));h.targets=h.targets||t.targets;var u=e.duration;h.autoplay=!1,h.direction=e.direction,h.timelineOffset=Ia.und(i)?u:po(i,u),a(e),e.seek(h.timelineOffset);var l=Do(h);a(l),s.push(l);var c=Oo(s,t);return e.delay=c.delay,e.endDelay=c.endDelay,e.duration=c.duration,e.seek(0),e.reset(),e.autoplay&&e.play(),e},e},Do.easing=Ha,Do.penner=Ga,Do.random=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};class zo{constructor({gl:t,scene:e,sizes:r}){this.gl=t,this.scene=e,this.sizes=r,this.group=new Xe,this.galleryWrapperElement=document.querySelector(".detail__gallery__wrapper"),this.scroll={current:0,start:0,target:0,lerp:.1},this.createGeometry(),this.createMedias(),this.onResize({sizes:this.sizes}),this.group.setParent(this.scene),this.createObserver()}createGeometry(){this.geometry=new lr(this.gl)}createMedias(){this.mediasElements=document.querySelectorAll(".detail__media"),this.medias=Ca(this.mediasElements,((t,e)=>new class{constructor({element:t,geometry:e,gl:r,index:i,scene:n,sizes:s}){this.element=t,this.gl=r,this.geometry=e,this.scene=n,this.index=i,this.sizes=s,this.extra={xPos:.2*Math.random()-.1,yPos:.2*Math.random()-.1,zPos:.5*Math.random()-.5,yPosScroll:Math.random()*(1.1-1.07)+1.07},this.createTexture(),this.createProgram(),this.createMesh(),this.createBounds({sizes:this.sizes})}createTexture(){const t=this.element.querySelector(".detail__media__image");this.texture=window.TEXTURES[t.getAttribute("data-src")]}createProgram(){this.program=new Me(this.gl,{fragment:"precision highp float;\n#define GLSLIFY 1\nuniform sampler2D tMap;uniform float threshold;uniform float uAlpha;varying vec2 vUv;void main(){vec4 texture=texture2D(tMap,vUv);float alpha=step(vUv.y,threshold);gl_FragColor=vec4(texture.rgb,alpha*texture.a*uAlpha);}",vertex:"#define GLSLIFY 1\nattribute vec3 position;attribute vec2 uv;uniform float u_mouseX;uniform float u_mouseY;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position+vec3(u_mouseX,u_mouseY,0.0),1.);}",uniforms:{threshold:{value:-.1},tMap:{value:this.texture},uAlpha:{value:1},u_mouseX:{value:0},u_mouseY:{value:0}}})}createMesh(){this.mesh=new Ke(this.gl,{geometry:this.geometry,program:this.program}),this.mesh.setParent(this.scene),this.mesh.position.z=this.extra.zPos}createBounds({sizes:t}){this.sizes=t,this.bounds=this.element.getBoundingClientRect(),this.updateScale(),this.updateX(),this.updateY()}show(){Do({targets:this.program.uniforms.threshold,value:1,duration:1100,easing:"easeOutQuint"})}hide(){return new Promise((t=>{Do({targets:this.program.uniforms.uAlpha,value:0,easing:"easeOutQuint",duration:2100,complete:()=>{t()}})}))}onResize(t,e){this.createBounds(t),this.updateX(e&&e.x),this.updateY(e&&e.y)}onMouseMove({posX:t,posY:e}){this.program.uniforms.u_mouseX.value=.02*t,this.program.uniforms.u_mouseY.value=.02*e}updateScale(){this.height=this.bounds.height/window.innerHeight,this.width=this.bounds.width/window.innerWidth,this.mesh.scale.x=this.sizes.width*this.width,this.mesh.scale.y=this.sizes.height*this.height}updateX(t=0){this.x=(this.bounds.left-t)/window.innerWidth,this.mesh.position.x=-this.sizes.width/2+this.mesh.scale.x/2+this.x*this.sizes.width+this.extra.xPos}updateY(t=0){this.y=(this.bounds.top-t*this.extra.yPosScroll)/window.innerHeight,this.mesh.position.y=this.sizes.height/2-this.mesh.scale.y/2-this.y*this.sizes.height+this.extra.yPos}update(t){this.updateScale(),this.updateX(),this.updateY(t)}}({element:t,geometry:this.geometry,index:e,gl:this.gl,scene:this.group,sizes:this.sizes})))}createObserver(){ne(this.mediasElements,((t,e)=>{new window.IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&this.show(e)}))})).observe(t)}))}show(t){this.medias[t].show()}async hide(){const t=this.medias.map((t=>t.hide()));await Promise.all(t),this.destroy()}onResize(t){this.sizes=t.sizes,this.bounds=this.galleryWrapperElement.getBoundingClientRect(),this.scroll.last=this.scroll.target=0,Ca(this.medias,(e=>e.onResize(t,this.scroll))),this.scroll.limit=this.bounds.height-this.medias[0].element.clientHeight}onMouseMove(t){Ca(this.medias,(e=>e.onMouseMove(t)))}onTouchDown(){this.scroll.last=this.scroll.current}onTouchMove({y:t}){const e=t.start-t.end;this.scroll.target=this.scroll.last+2*e}onTouchUp(){}onWheel({pixelY:t}){this.scroll.target+=t}update(){this.scroll.target=Math.min(Math.max(this.scroll.target,0),this.scroll.limit),this.scroll.current=this.scroll.current+.1*(this.scroll.target-this.scroll.current),this.scroll.current<.01&&(this.scroll.current=0),this.galleryWrapperElement.style.transform=`translate3d(0, -${this.scroll.current}px, 0)`,Ca(this.medias,(t=>t.update(this.scroll.current)))}destroy(){this.scene.removeChild(this.group)}}class Uo{constructor({element:t,geometry:e,gl:r,index:i,scene:n,sizes:s}){this.element=t,this.gl=r,this.geometry=e,this.scene=n,this.index=i,this.sizes=s,this.extra={x:0,y:0},this.aspect=1,this.mouse=new ur(-1),this.velocity=new ur,this.createFlowmap(),this.createTexture(),this.createProgram(),this.createMesh(),this.createBounds({sizes:this.sizes})}createFlowmap(){this.flowmap=new dr(this.gl)}createTexture(){const t=this.element.querySelector(".about__media__image");this.texture=window.TEXTURES[t.getAttribute("data-src")]}createProgram(){this.program=new Me(this.gl,{fragment:"precision highp float;\n#define GLSLIFY 1\nuniform sampler2D tMap;uniform sampler2D tFlow;uniform float threshold;uniform float uAlpha;varying vec2 vUv;void main(){vec2 textureCenter=vec2(0.5,0.5);vec2 uv=(vUv-textureCenter)+0.5;vec3 flow=texture2D(tFlow,vUv).rgb;uv+=flow.xy*0.0005;vec4 tex=texture2D(tMap,uv);float alpha=step(vUv.y,threshold);gl_FragColor=vec4(tex.rgb,alpha*tex.a*uAlpha);}",vertex:"#define GLSLIFY 1\nattribute vec3 position;attribute vec2 uv;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",uniforms:{threshold:{value:-.1},tMap:{value:this.texture},uAlpha:{value:1},tFlow:this.flowmap.uniform}})}createMesh(){this.mesh=new Ke(this.gl,{geometry:this.geometry,program:this.program}),this.mesh.setParent(this.scene)}createBounds({sizes:t}){this.sizes=t,this.bounds=this.element.getBoundingClientRect(),this.updateScale(),this.updateX(),this.updateY()}show(){Do({targets:this.program.uniforms.threshold,value:1,duration:1100,easing:"easeOutQuint"})}hide(){return new Promise((t=>{Do({targets:this.program.uniforms.uAlpha,value:0,easing:"easeOutQuint",duration:2100,complete:()=>{t()}})}))}onPointerMove(t){this.lastTime,this.lastMouse=new ur,t.changedTouches&&t.changedTouches.length&&(t.x=t.changedTouches[0].pageX,t.y=t.changedTouches[0].pageY),void 0===t.x&&(t.x=t.pageX,t.y=t.pageY),this.mouse.set((t.x-this.bounds.left)/this.bounds.width,1-(t.y-this.bounds.top)/this.bounds.height),this.lastTime||(this.lastTime=performance.now(),this.lastMouse.set(t.x,t.y));const e=t.x-this.lastMouse.x,r=t.y-this.lastMouse.y;this.lastMouse.set(t.x,t.y);let i=performance.now(),n=Math.max(14,i-this.lastTime);this.lastTime=i,this.velocity.x=e/n,this.velocity.y=r/n,this.velocity.needsUpdate=!0}updateMouse(){this.velocity.needsUpdate||(this.mouse.set(-1),this.velocity.set(0)),this.velocity.needsUpdate=!1,this.flowmap.aspect=this.aspect,this.flowmap.mouse.copy(this.mouse),this.flowmap.velocity.lerp(this.velocity,this.velocity.len()?.5:.1),this.flowmap.update()}onResize(t){this.extra={x:0,y:0},this.aspect=window.innerWidth/window.innerHeight,this.createBounds(t),this.updateX(),this.updateY()}updateScale(){this.height=this.bounds.height/window.innerHeight,this.width=this.bounds.width/window.innerWidth,this.mesh.scale.x=this.sizes.width*this.width,this.mesh.scale.y=this.sizes.height*this.height}updateX(t=0){this.x=(this.bounds.left-t)/window.innerWidth,this.mesh.position.x=-this.sizes.width/2+this.mesh.scale.x/2+this.x*this.sizes.width+this.extra.x}updateY(t=0){this.y=(this.bounds.top-t)/window.innerHeight,this.mesh.position.y=this.sizes.height/2-this.mesh.scale.y/2-this.y*this.sizes.height+this.extra.y}update(){this.updateScale(),this.updateX(),this.updateY(),this.updateMouse()}}class Io{constructor({gl:t,scene:e,sizes:r}){this.gl=t,this.scene=e,this.sizes=r,this.group=new Xe,this.createGeometry(),this.createMedias(),this.onResize({sizes:this.sizes}),this.group.setParent(this.scene),this.show(),this.event()}createGeometry(){this.geometry=new lr(this.gl)}createMedias(){this.mediaElement=document.querySelector(".about__media"),this.media=new Uo({element:this.mediaElement,geometry:this.geometry,gl:this.gl,scene:this.group,sizes:this.sizes})}event(){this.mediaElement.addEventListener("pointermove",(t=>{this.media.onPointerMove(t)}))}show(){this.media.show()}async hide(){await this.media.hide(),this.destroy()}onResize(t){this.sizes=t.sizes,this.bounds=this.mediaElement.getBoundingClientRect(),this.media.onResize(t)}update(){this.media.update()}destroy(){this.scene.removeChild(this.group)}}class jo{constructor({template:t}){this.template=t,this.y={start:0,end:0},this.positions={posX:0,posY:0},this.createRenderer(),this.createScene(),this.createCamera(),this.onResize()}createRenderer(){this.renderer=new Ce({alpha:!0,antialias:!0,dpr:1.5}),this.gl=this.renderer.gl,document.body.appendChild(this.gl.canvas)}createCamera(){this.camera=new Ve(this.gl),this.camera.position.z=5}createScene(){this.scene=new Xe}createDetail(){this.detail=new zo({gl:this.gl,scene:this.scene,sizes:this.sizes})}createAbout(){this.about=new Io({gl:this.gl,scene:this.scene,sizes:this.sizes})}onPreloaded(){this.onChangeEnd(this.template)}onChangeStart(){this.detail&&this.detail.hide(),this.about&&this.about.hide()}onChangeEnd(t){"detail"===t&&this.createDetail(),"about"===t&&this.createAbout(),this.template=t}onResize(){this.renderer.setSize(window.innerWidth,window.innerHeight),this.camera.perspective({aspect:window.innerWidth/window.innerHeight});const t=this.camera.fov*(Math.PI/180),e=2*Math.tan(t/2)*this.camera.position.z,r=e*this.camera.aspect;this.sizes={height:e,width:r};const i={sizes:this.sizes};this.detail&&this.detail.onResize(i),this.about&&this.about.onResize(i)}onMouseMove(t){this.positions.posX=t.clientX/window.innerWidth*2-1,this.positions.posY=-t.clientY/window.innerHeight*2+1,this.detail&&this.detail.onMouseMove(this.positions)}onTouchDown(t){this.isDown=!0,this.y.start=t.touches?t.touches[0].clientY:t.clientY,this.detail&&this.detail.onTouchDown()}onTouchMove(t){if(!this.isDown)return;const e=t.touches?t.touches[0].clientY:t.clientY;this.y.end=e;const r={y:this.y};this.detail&&this.detail.onTouchMove(r)}onTouchUp(){this.isDown=!1}onWheel(t){this.detail&&this.detail.onWheel(t)}update(t){this.detail&&this.detail.update(t),this.about&&this.about.update(),this.renderer.render({camera:this.camera,scene:this.scene})}}function ko(){}function Yo(){Yo.init.call(this)}function qo(t){return void 0===t._maxListeners?Yo.defaultMaxListeners:t._maxListeners}function Xo(t,e,r,i){var n,s,a,o;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((s=t._events)?(s.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),a=s[e]):(s=t._events=new ko,t._eventsCount=0),a){if("function"==typeof a?a=s[e]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),!a.warned&&(n=qo(t))&&n>0&&a.length>n){a.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=a.length,o=h,"function"==typeof console.warn?console.warn(o):console.log(o)}}else a=s[e]=r,++t._eventsCount;return t}function Wo(t,e,r){var i=!1;function n(){t.removeListener(e,n),i||(i=!0,r.apply(t,arguments))}return n.listener=r,n}function Go(t){var e=this._events;if(e){var r=e[t];if("function"==typeof r)return 1;if(r)return r.length}return 0}function Ho(t,e){for(var r=new Array(e);e--;)r[e]=t[e];return r}ko.prototype=Object.create(null),Yo.EventEmitter=Yo,Yo.usingDomains=!1,Yo.prototype.domain=void 0,Yo.prototype._events=void 0,Yo.prototype._maxListeners=void 0,Yo.defaultMaxListeners=10,Yo.init=function(){this.domain=null,Yo.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new ko,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Yo.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},Yo.prototype.getMaxListeners=function(){return qo(this)},Yo.prototype.emit=function(t){var e,r,i,n,s,a,o,h="error"===t;if(a=this._events)h=h&&null==a.error;else if(!h)return!1;if(o=this.domain,h){if(e=arguments[1],!o){if(e instanceof Error)throw e;var u=new Error('Uncaught, unspecified "error" event. ('+e+")");throw u.context=e,u}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=o,e.domainThrown=!1,o.emit("error",e),!1}if(!(r=a[t]))return!1;var l="function"==typeof r;switch(i=arguments.length){case 1:!function(t,e,r){if(e)t.call(r);else for(var i=t.length,n=Ho(t,i),s=0;s<i;++s)n[s].call(r)}(r,l,this);break;case 2:!function(t,e,r,i){if(e)t.call(r,i);else for(var n=t.length,s=Ho(t,n),a=0;a<n;++a)s[a].call(r,i)}(r,l,this,arguments[1]);break;case 3:!function(t,e,r,i,n){if(e)t.call(r,i,n);else for(var s=t.length,a=Ho(t,s),o=0;o<s;++o)a[o].call(r,i,n)}(r,l,this,arguments[1],arguments[2]);break;case 4:!function(t,e,r,i,n,s){if(e)t.call(r,i,n,s);else for(var a=t.length,o=Ho(t,a),h=0;h<a;++h)o[h].call(r,i,n,s)}(r,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(i-1),s=1;s<i;s++)n[s-1]=arguments[s];!function(t,e,r,i){if(e)t.apply(r,i);else for(var n=t.length,s=Ho(t,n),a=0;a<n;++a)s[a].apply(r,i)}(r,l,this,n)}return!0},Yo.prototype.addListener=function(t,e){return Xo(this,t,e,!1)},Yo.prototype.on=Yo.prototype.addListener,Yo.prototype.prependListener=function(t,e){return Xo(this,t,e,!0)},Yo.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,Wo(this,t,e)),this},Yo.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,Wo(this,t,e)),this},Yo.prototype.removeListener=function(t,e){var r,i,n,s,a;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(r=i[t]))return this;if(r===e||r.listener&&r.listener===e)0==--this._eventsCount?this._events=new ko:(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(n=-1,s=r.length;s-- >0;)if(r[s]===e||r[s].listener&&r[s].listener===e){a=r[s].listener,n=s;break}if(n<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new ko,this;delete i[t]}else!function(t,e){for(var r=e,i=r+1,n=t.length;i<n;r+=1,i+=1)t[r]=t[i];t.pop()}(r,n);i.removeListener&&this.emit("removeListener",t,a||e)}return this},Yo.prototype.off=function(t,e){return this.removeListener(t,e)},Yo.prototype.removeAllListeners=function(t){var e,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new ko,this._eventsCount=0):r[t]&&(0==--this._eventsCount?this._events=new ko:delete r[t]),this;if(0===arguments.length){for(var i,n=Object.keys(r),s=0;s<n.length;++s)"removeListener"!==(i=n[s])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new ko,this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},Yo.prototype.listeners=function(t){var e,r=this._events;return r&&(e=r[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(e):[]},Yo.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):Go.call(t,e)},Yo.prototype.listenerCount=Go,Yo.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};class Vo extends Yo{constructor({element:t,elements:e}){super(),this.selector=t,this.selectorChildren={...e},this.create(),this.addEventListeners()}create(){this.selector instanceof window.HTMLElement?this.element=this.selector:this.element=document.querySelector(this.selector),this.elements={},ne(this.selectorChildren,((t,e)=>{t instanceof window.HTMLElement||t instanceof window.NodeList||Array.isArray(t)?this.elements[e]=t:(this.elements[e]=document.querySelectorAll(t),0===this.elements[e].length?this.elements[e]=null:1===this.elements[e].length&&(this.elements[e]=document.querySelector(t)))}))}addEventListeners(){}removeEventListeners(){}}class $o extends Vo{constructor({canvas:t=null}){super({element:".preloader",elements:{background:".preloader__background",numberText:".preloader__number__text"}}),this.canvas=t,window.TEXTURES={},this.length=0,this.createLoader()}createLoader(){this.canvas?ne(window.ASSETS,(t=>{const e=new rr(this.canvas.gl,{generateMipMaps:!1}),r=new window.Image;r.crossOrigin="anonymous",r.src=t,r.onload=t=>{e.image=r,this.onAssetLoaded()},window.TEXTURES[t]=e})):ne(window.ASSETS,(t=>{const e=new window.Image;e.crossOrigin="anonymous",e.src=t,e.onload=t=>{this.onAssetLoaded()}}))}onAssetLoaded(){this.length++;const t=this.length/window.ASSETS.length;this.elements.numberText.innerHTML=`${Math.round(100*t)}%`,1===t&&this.onLoaded()}onLoaded(){return new Promise((t=>{this.animationOut=Do.timeline({begin:()=>{this.emit("completed")},complete:()=>{this.destroy()}}),this.animationOut.add({targets:this.element,opacity:"0",easing:"easeOutQuint",duration:600},1e3)}))}destroy(){this.element.parentNode.removeChild(this.element)}}class Qo extends Vo{constructor({template:t}){super({element:".navigation",elements:{items:".navigation__list__item",links:".navigation__list__link"}}),this.onChange(t)}onChange(t){"home"===t?(Do({targets:this.elements.links[1],pointerEvents:"none",translateY:"-110%",easing:"easeOutQuint",duration:700}),Do.set(this.elements.links[0],{translateY:"110%",pointerEvents:"auto"}),Do({targets:this.elements.links[0],easing:"easeOutQuint",translateY:"0%",duration:700})):(Do({targets:this.elements.links[0],translateY:"-110%",pointerEvents:"none",easing:"easeOutQuint",duration:700}),Do.set(this.elements.links[1],{translateY:"110%",pointerEvents:"auto"}),Do({targets:this.elements.links[1],easing:"easeOutQuint",translateY:"0%",duration:700}))}}class Zo extends Vo{constructor(){super({element:".grid"}),this.opacities=[0,.15,.3],this.index=1}onChange(){this.index>2&&(this.index=0),this.element.style.opacity=this.opacities[this.index],this.index+=1}}class Ko extends Vo{constructor({element:t}){super({element:t}),this.createObserver()}createObserver(){this.observer=new window.IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&(this.element.src||(this.element.src=this.element.getAttribute("data-src"),this.element.onload=t=>{this.element.classList.add("loaded")}))}))})),this.observer.observe(this.element)}}class Jo{constructor({element:t,elements:e,id:r,device:i}){this.selector=t,this.selectorChildren={...e,preloaders:"[data-src]"},this.id=r,this.isMobile=i,this.alert=document.querySelector(".alert")}create(){this.element=document.querySelector(this.selector),this.elements={},this.isMobile&&(window.scrollY=0,document.documentElement.scrollTop=0,document.body.scrollTop=0),this.scroll={current:0,target:0,last:0,limit:0,skew:0},this.y={start:0,end:0},ne(this.selectorChildren,((t,e)=>{t instanceof window.HTMLElement||t instanceof window.NodeList||Array.isArray(t)?this.elements[e]=t:(this.elements[e]=document.querySelectorAll(t),0===this.elements[e].length?this.elements[e]=null:1===this.elements[e].length&&(this.elements[e]=document.querySelector(t)))})),this.createPreloader()}createPreloader(){this.isMobile&&(this.preloaders=Ca(this.elements.preloaders,(t=>new Ko({element:t}))))}onResize(){this.scroll.last=this.scroll.target=0,this.elements.wrapper&&(this.scroll.limit=this.elements.wrapper.clientHeight-window.innerHeight/1.7),this.isMobile&&(window.innerHeight<window.innerWidth?this.alert.style.opacity=1:this.alert.style.opacity=0)}onTouchDown(t){this.isDown=!0,this.y.start=t.touches?t.touches[0].clientY:t.clientY,this.scroll.last=this.scroll.current}onTouchMove(t){if(!this.isDown)return;const e=t.touches?t.touches[0].clientY:t.clientY;this.y.end=e;const r=this.y.start-this.y.end;this.scroll.target=this.scroll.last+2*r}onTouchUp(){this.isDown=!1}onWheel({pixelY:t}){this.scroll.target+=t}update(){if(this.scroll.target=Math.min(Math.max(this.scroll.target,0),this.scroll.limit),this.scroll.current=this.scroll.current+.1*(this.scroll.target-this.scroll.current),this.scroll.skew=this.scroll.skew+.01*(this.scroll.target-this.scroll.current),this.scroll.current<.01&&(this.scroll.current=0),this.elements.wrapper&&!this.isMobile){this.elements.wrapper.style.transform=`\n        translate3d(0, -${this.scroll.current}px, 0) \n        skewY(${this.scroll.skew}deg)\n      `,this.scroll.skew=0;const t=this.element.querySelectorAll(".item"),e=window.innerHeight/2;ne(t,(t=>{const r=t.getBoundingClientRect();r.top<e&&r.bottom>e?t.classList.add("item_on_middle"):t.classList.remove("item_on_middle")}))}}addEventListeners(){}removeEventListeners(){}}class th extends Jo{constructor(t){super({id:"home",device:t,element:".home",elements:{wrapper:".home__list"}}),this.mobile=t}textShow(t){this.page=document.querySelector(".home"),this.texts=this.page.querySelectorAll(".item__wrapper");const e=t?1200:0;this.mobile?Do({targets:this.page,opacity:["0","1"],easing:"easeOutQuint",duration:500}):Do({targets:this.texts,translateY:["105%","0%"],easing:"easeOutQuint",duration:700,delay:Do.stagger(50,{start:e})})}textHide(){this.mobile?Do({targets:this.page,opacity:"0",easing:"easeOutCubic",duration:500,complete:()=>{this.page.remove()}}):Do({targets:this.texts,translateY:"-97%",easing:"easeOutCubic",duration:2100,complete:()=>{this.page.remove()}})}show(t){this.textShow(t)}hide(){this.textHide()}}function eh({element:t,expression:e=" ",append:r=!0}){const i=function(t,e){const r=t.split("<br>");let i=[];return ne(r,((t,r)=>{r>0&&i.push("<br>"),i=i.concat(t.split(e));let n=!1,s="";const a=[];ne(i,(t=>{n||!t.includes("<a")&&!t.includes("<strong")||(s="",n=!0),n&&(s+=` ${t}`),n&&(t.includes("/a>")||t.includes("/strong>"))&&(a.push(s),s=""),n||""!==s||a.push(t),n&&(t.includes("/a>")||t.includes("/strong>"))&&(n=!1)})),i=a})),i}(t.innerHTML.toString().trim(),e);let n="";ne(i,(t=>{if(t.indexOf("<br>")>-1){const e=t.split("<br>");ne(e,((t,e)=>{n+=e>0?"<br>"+rh(t):rh(t)}))}else n+=rh(t)})),t.innerHTML=n;const s=t.querySelectorAll("span");return r&&ne(s,(t=>{const e=1===t.textContent.length,r=""!==t.innerHTML.trim(),i="&"!==t.textContent,n="-"!==t.textContent;e&&r&&i&&n&&(t.innerHTML=`${t.textContent}&nbsp;`)})),s}function rh(t){return""===(t=t.trim())||" "===t?t:"<br>"===t?"<br>":`<span>${t}</span>`+(t.length>1?" ":"")}class ih extends Jo{constructor(t){super({id:"detail",device:t,element:".detail"}),this.mobile=t}textShow(t){this.page=document.querySelector(".detail"),this.texts=this.page.querySelectorAll("h1, h2, p");const e=t?1950:0;ne(this.texts,(t=>{eh({element:t,expression:"<br>"}),eh({element:t,expression:"<br>"})})),this.spans=this.page.querySelectorAll("span span"),this.mobile?Do({targets:this.page,opacity:["0","1"],easing:"easeOutQuint",duration:500}):Do({targets:this.spans,translateY:["110%","0%"],easing:"easeOutQuint",duration:700,delay:Do.stagger(50,{start:e})})}textHide(){this.mobile?Do({targets:this.page,opacity:"0",easing:"easeOutCubic",duration:500,complete:()=>{this.page.remove()}}):Do({targets:this.spans,translateY:"-110%",easing:"easeOutCubic",duration:2100,complete:()=>{this.page.remove()}})}show(t){this.textShow(t)}hide(){this.textHide()}}class nh extends Jo{constructor(t){super({id:"about",device:t,element:".about"}),this.mobile=t}textShow(t){this.page=document.querySelector(".about"),this.links=this.page.querySelectorAll("a"),this.texts=this.page.querySelectorAll("h1, h2, p");const e=t?1950:0;ne(this.texts,(t=>{eh({element:t,expression:"<br>"}),eh({element:t,expression:"<br>"})})),this.spans=this.page.querySelectorAll("span span"),this.mobile?Do({targets:this.page,opacity:["0","1"],easing:"easeOutQuint",duration:500}):(Do({targets:this.spans,translateY:["105%","0%"],easing:"easeOutQuint",duration:700,delay:Do.stagger(50,{start:e})}),Do({targets:this.links,opacity:[0,1],duration:500,easing:"linear",delay:e+800}))}textHide(){this.mobile?Do({targets:this.page,opacity:"0",easing:"easeOutCubic",duration:500,complete:()=>{this.page.remove()}}):(Do({targets:this.links,opacity:0,duration:2100,easing:"easeOutCubic"}),Do({targets:this.spans,translateY:"-105%",easing:"easeOutCubic",duration:2100,complete:()=>{this.page.remove()}}))}show(t){this.textShow(t)}hide(){this.textHide()}}new class{constructor(){this.createContent(),this.DetectDevice(),this.createCanvas(),this.createPreloader(),this.createNavigation(),this.createGrid(),this.createPages(),this.addEventListeners(),this.addLinkListeners(),this.onResize(),this.update()}createContent(){this.content=document.querySelector(".content"),this.template=this.content.getAttribute("data-template")}DetectDevice(){this.isMobile=se.isMobile()}createCanvas(){this.isMobile||(this.canvas=new jo({template:this.template}))}createPreloader(){this.preloader=new $o({canvas:this.canvas}),this.preloader.once("completed",this.onPreloaded.bind(this))}createNavigation(){this.navigation=new Qo({template:this.template})}createGrid(){this.grid=new Zo}createPages(){this.pages={home:new th(this.isMobile),detail:new ih(this.isMobile),about:new nh(this.isMobile)},this.page=this.pages[this.template],this.page.create()}onPreloaded(){this.onResize(),this.canvas&&this.canvas.onPreloaded(),this.page.show(!0)}onPopState(){this.onChange({url:window.location.pathname,push:!1})}async onChange({url:t,push:e=!0}){this.page.hide(),this.canvas&&this.canvas.onChangeStart();const r=await window.fetch(t);if(200===r.status){e&&window.history.pushState({},"",t);const i=await r.text(),n=document.createElement("div");n.innerHTML=i;const s=n.querySelector(".content"),a=s.querySelector("div");this.template=s.getAttribute("data-template"),this.navigation.onChange(this.template),this.content.setAttribute("data-template",this.template),this.content.append(a),this.page=this.pages[this.template],this.page.create(),this.onResize(),this.page.show(),this.canvas&&this.canvas.onChangeEnd(this.template),this.addLinkListeners()}else console.error(`response status: ${r.status}`)}onResize(){this.page&&this.page.onResize&&this.page.onResize(),window.requestAnimationFrame((t=>{this.canvas&&this.canvas.onResize&&this.canvas.onResize()}))}onTouchDown(t){this.canvas&&this.canvas.onTouchDown&&this.canvas.onTouchDown(t),this.page&&this.page.onTouchDown&&this.page.onTouchDown(t)}onMouseMove(t){this.canvas&&this.canvas.onMouseMove&&this.canvas.onMouseMove(t)}onTouchMove(t){this.canvas&&this.canvas.onTouchMove&&this.canvas.onTouchMove(t),this.page&&this.page.onTouchDown&&this.page.onTouchMove(t)}onTouchUp(t){this.canvas&&this.canvas.onTouchUp&&this.canvas.onTouchUp(t),this.page&&this.page.onTouchDown&&this.page.onTouchUp(t)}onWheel(t){const e=S(t);this.canvas&&this.canvas.onWheel&&this.canvas.onWheel(e),this.page&&this.page.onWheel&&this.page.onWheel(e)}onKeyDown(){this.grid.onChange()}update(){this.page&&this.page.update&&this.page.update(),this.canvas&&this.canvas.update&&this.canvas.update(this.page.scroll),window.requestAnimationFrame(this.update.bind(this))}addEventListeners(){window.addEventListener("mousewheel",this.onWheel.bind(this)),window.addEventListener("popstate",this.onPopState.bind(this)),window.addEventListener("mousedown",this.onTouchDown.bind(this)),window.addEventListener("mousemove",this.onTouchMove.bind(this)),window.addEventListener("mousemove",this.onMouseMove.bind(this)),window.addEventListener("mouseup",this.onTouchUp.bind(this)),window.addEventListener("touchstart",this.onTouchDown.bind(this)),window.addEventListener("touchmove",this.onTouchMove.bind(this)),window.addEventListener("touchend",this.onTouchUp.bind(this)),window.addEventListener("keydown",function(t){t.shiftKey&&"G"===t.key&&this.onKeyDown()}.bind(this)),window.addEventListener("resize",this.onResize.bind(this))}addLinkListeners(){let t=!1;const e=document.querySelectorAll("a");ne(e,(e=>{-1===e.href.indexOf(window.location.origin)||(e.onclick=r=>{if(r.preventDefault(),t)return;t=!0;const{href:i}=e;this.onChange({url:i}),setTimeout((()=>{t=!1}),800)})}))}};
